{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/imports/ui/components/BaseUploadBook/index.vue","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions",["flow",{}],"nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"jsx","jsx","jsx","jsx","jsx"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"sourceFileName":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/imports/ui/components/BaseUploadBook/index.vue","filename":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/imports/ui/components/BaseUploadBook/index.vue","passPerPreset":false,"envName":"development","cwd":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui","root":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.7.6","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":{},"_verified":{},"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"TSModuleBlock":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}},{"key":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/node_modules/@vue/babel-preset-jsx/dist/plugin.cjs.js$0","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/node_modules/@vue/babel-preset-jsx/dist/plugin.cjs.js$1","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/node_modules/@vue/babel-preset-jsx/dist/plugin.cjs.js$2","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/node_modules/@vue/babel-preset-jsx/dist/plugin.cjs.js$3","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"babel-plugin-transform-vue-jsx","visitor":{"_exploded":{},"_verified":{},"JSXElement":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/imports/ui/components/BaseUploadBook/index.vue","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/imports/ui/components/BaseUploadBook/index.vue"}},"code":"var _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 0);\n\nvar _regeneratorRuntime;\n\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 1);\n\nvar _;\n\nmodule.link(\"lodash\", {\n  \"default\": function (v) {\n    _ = v;\n  }\n}, 0);\nvar SparkMD5;\nmodule.link(\"spark-md5\", {\n  \"default\": function (v) {\n    SparkMD5 = v;\n  }\n}, 1);\nvar ePub;\nmodule.link(\"epubjs\", {\n  \"default\": function (v) {\n    ePub = v;\n  }\n}, 2);\nvar BookModel;\nmodule.link(\"./BookModel\", {\n  \"default\": function (v) {\n    BookModel = v;\n  }\n}, 3);\nvar UploadButton;\nmodule.link(\"./UploadButton\", {\n  \"default\": function (v) {\n    UploadButton = v;\n  }\n}, 4);\nvar UserFiles;\nmodule.link(\"../../../features/books/app/collections\", {\n  \"default\": function (v) {\n    UserFiles = v;\n  }\n}, 5);\nmodule.exportDefault({\n  props: ['value'],\n  components: {\n    UploadButton: UploadButton\n  },\n  data: function () {\n    return {\n      isLoading: true,\n      book: {\n        cover: null,\n        name: \"未上传\"\n      }\n    };\n  },\n  mounted: function () {\n    var _this = this;\n\n    // debugger\n    if (this.value) {\n      Meteor.call(\"books.findOne\", {\n        _id: this.value\n      }, function (err, res) {\n        _this.isLoading = false;\n\n        if (err) {\n          _this.$message.error(err);\n\n          return;\n        } // debugger\n\n\n        _this.book = res;\n      });\n    } else {\n      this.isLoading = false;\n    }\n  },\n  methods: {\n    trunc: function (str, n) {\n      return str.length > n ? str.substr(0, n - 3) + \"...\" : str;\n    },\n    // 上传书籍\n    uploadFile: function (files) {\n      var _this2 = this;\n\n      if (files) {\n        var uploadInstance = UserFiles.insert({\n          file: files[0],\n          meta: {\n            userId: Meteor.userId()\n          },\n          chunkSize: \"dynamic\",\n          allowWebWorkers: true\n        }, false);\n        uploadInstance.on(\"uploaded\", function (error, fileObj) {\n          if (error) {\n            return;\n          }\n\n          if (window.FileReader) {\n            // 将文件转换成Epub格式的文件\n            _this2.getMd5WithBrowser(files[0], fileObj._id);\n          }\n        });\n        uploadInstance.on(\"error\", function (error, fileObj) {\n          alert(error);\n        });\n        uploadInstance.start();\n      }\n    },\n    // 转化为File格式的文件\n    getMd5WithBrowser: function (file, id) {\n      var _this3 = this;\n\n      return new Promise(function (resolve, reject) {\n        var blobSlice = File.prototype.slice || File.prototype.mozSlice || File.prototype.webkitSlice,\n            chunkSize = 2097152,\n            // 以每片2MB大小来逐次读取\n        chunks = Math.ceil(file.size / chunkSize),\n            currentChunk = 0,\n            spark = new SparkMD5(),\n            //创建SparkMD5的实例\n        fileReader = new FileReader();\n\n        fileReader.onload = function _callee(e) {\n          var md5;\n          return _regeneratorRuntime.async(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  if (e.target) {\n                    _context.next = 3;\n                    break;\n                  }\n\n                  reject();\n                  throw new Error();\n\n                case 3:\n                  spark.appendBinary(e.target.result); // append array buffer\n\n                  currentChunk += 1;\n\n                  if (!(currentChunk < chunks)) {\n                    _context.next = 9;\n                    break;\n                  }\n\n                  loadNext();\n                  _context.next = 13;\n                  break;\n\n                case 9:\n                  md5 = spark.end(); // 完成计算，返回结果\n\n                  _context.next = 12;\n                  return _regeneratorRuntime.awrap(_this3.handleBook(file, md5, id));\n\n                case 12:\n                  resolve();\n\n                case 13:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          });\n        };\n\n        var loadNext = function () {\n          var start = currentChunk * chunkSize,\n              end = start + chunkSize >= file.size ? file.size : start + chunkSize;\n          fileReader.readAsBinaryString(blobSlice.call(file, start, end));\n        };\n\n        loadNext();\n      });\n    },\n    // 处理文件\n    handleBook: function (file, md5, id) {\n      var _this4 = this;\n\n      var extension = file.name.split(\".\").reverse()[0];\n      var bookName = file.name.substr(0, file.name.length - extension.length - 1);\n      return new Promise(function (resolve, reject) {\n        Meteor.call(\"books.find\", {\n          md5: md5,\n          name: bookName\n        }, function (err, result) {\n          if (err) {\n            return _this4.$message.error(err);\n          }\n\n          if (result.length !== 0) {\n            return _this4.$message.error(\"书籍名已经存在\");\n          }\n\n          var reader = new FileReader();\n          reader.readAsArrayBuffer(file);\n\n          reader.onload = function _callee4(e) {\n            var cover, epub;\n            return _regeneratorRuntime.async(function _callee4$(_context4) {\n              while (1) {\n                switch (_context4.prev = _context4.next) {\n                  case 0:\n                    if (e.target) {\n                      _context4.next = 3;\n                      break;\n                    }\n\n                    reject();\n                    throw new Error();\n\n                  case 3:\n                    cover = \"\";\n                    epub = ePub(e.target.result, \"binary\");\n                    epub.loaded.metadata.then(function (metadata) {\n                      if (!e.target) {\n                        reject();\n                        throw new Error();\n                      }\n\n                      epub.coverUrl().then(function _callee3(url) {\n                        var reader, blob, key, name, author, publisher, description, _ref2, format, book;\n\n                        return _regeneratorRuntime.async(function _callee3$(_context3) {\n                          while (1) {\n                            switch (_context3.prev = _context3.next) {\n                              case 0:\n                                if (!url) {\n                                  _context3.next = 9;\n                                  break;\n                                }\n\n                                reader = new FileReader();\n                                _context3.next = 4;\n                                return _regeneratorRuntime.awrap(fetch(url).then(function (r) {\n                                  return r.blob();\n                                }));\n\n                              case 4:\n                                blob = _context3.sent;\n                                reader.readAsDataURL(blob);\n\n                                reader.onloadend = function _callee2() {\n                                  var key, name, author, description, publisher, _ref, format, book;\n\n                                  return _regeneratorRuntime.async(function _callee2$(_context2) {\n                                    while (1) {\n                                      switch (_context2.prev = _context2.next) {\n                                        case 0:\n                                          cover = reader.result;\n                                          _ref = [metadata.title, metadata.creator, metadata.description, metadata.publisher];\n                                          name = _ref[0];\n                                          author = _ref[1];\n                                          description = _ref[2];\n                                          publisher = _ref[3];\n                                          format = \"EPUB\";\n                                          key = new Date().getTime() + \"\";\n                                          book = new BookModel(key, name, author, description, md5, cover, format, publisher);\n                                          console.log(\"key\");\n\n                                          _this4.handleAddBook(book, id);\n\n                                          resolve();\n\n                                        case 12:\n                                        case \"end\":\n                                          return _context2.stop();\n                                      }\n                                    }\n                                  });\n                                };\n\n                                _context3.next = 20;\n                                break;\n\n                              case 9:\n                                cover = \"noCover\";\n                                _ref2 = [metadata.title, metadata.creator, metadata.description, metadata.publisher];\n                                name = _ref2[0];\n                                author = _ref2[1];\n                                description = _ref2[2];\n                                publisher = _ref2[3];\n                                format = \"EPUB\";\n                                key = new Date().getTime() + \"\";\n                                book = new BookModel(key, name, author, description, md5, cover, format, publisher);\n\n                                _this4.handleAddBook(book, id); // BookUtil.addBook(key, e.target\n                                //   .result);\n\n\n                                resolve();\n\n                              case 20:\n                              case \"end\":\n                                return _context3.stop();\n                            }\n                          }\n                        });\n                      }).catch(function (err) {\n                        console.log(err, \"err\");\n                        reject();\n                      });\n                    }).catch(function () {\n                      console.log(\"Error occurs\");\n                      reject();\n                    });\n\n                  case 6:\n                  case \"end\":\n                    return _context4.stop();\n                }\n              }\n            });\n          };\n        });\n      });\n    },\n    // 添加Book到数据库\n    handleAddBook: function (book, id) {\n      var _this5 = this;\n\n      return new Promise(function (resolve, reject) {\n        Meteor.call(\"books.add\", _objectSpread({\n          fileId: id\n        }, book), function (err, res) {\n          if (err) {\n            return _this5.$message.error(err);\n          }\n\n          _this5.book = book;\n\n          _this5.$emit(\"input\", res);\n\n          _this5.$message.success(\"添加成功成功\");\n        });\n      });\n    }\n  }\n});","map":{"version":3,"sources":["/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/imports/ui/components/BaseUploadBook/index.vue"],"names":["_objectSpread","module","link","default","v","_regeneratorRuntime","_","SparkMD5","ePub","BookModel","UploadButton","UserFiles","exportDefault","props","components","data","isLoading","book","cover","name","mounted","value","Meteor","call","_id","err","res","$message","error","methods","trunc","str","n","length","substr","uploadFile","files","uploadInstance","insert","file","meta","userId","chunkSize","allowWebWorkers","on","fileObj","window","FileReader","getMd5WithBrowser","alert","start","id","Promise","resolve","reject","blobSlice","File","prototype","slice","mozSlice","webkitSlice","chunks","Math","ceil","size","currentChunk","spark","fileReader","onload","e","target","Error","appendBinary","result","loadNext","md5","end","handleBook","readAsBinaryString","extension","split","reverse","bookName","reader","readAsArrayBuffer","epub","loaded","metadata","then","coverUrl","url","fetch","r","blob","readAsDataURL","onloadend","title","creator","description","publisher","author","format","key","Date","getTime","console","log","handleAddBook","catch","fileId","$emit","success"],"mappings":"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","sourcesContent":["\nimport _ from \"lodash\";\nimport SparkMD5 from \"spark-md5\";\nimport ePub from \"epubjs\";\nimport BookModel from \"./BookModel\";\nimport UploadButton from \"./UploadButton\";\nimport UserFiles from \"../../../features/books/app/collections\";\nexport default {\n  props: ['value'],\n  components: {\n    UploadButton,\n  },\n  data() {\n    return {\n      isLoading: true,\n      book: {\n        cover: null,\n        name: \"未上传\",\n      },\n    };\n  },\n  mounted() {\n    // debugger\n    if (this.value) {\n      Meteor.call(\n        \"books.findOne\",\n        {\n          _id: this.value,\n        },\n        (err, res) => {\n          this.isLoading = false;\n          if (err) {\n            this.$message.error(err);\n            return;\n          }\n          // debugger\n          this.book = res;\n        }\n      );\n    } else {\n      this.isLoading = false;\n    }\n  },\n  methods: {\n    trunc(str, n) {\n      return str.length > n ? `${str.substr(0, n - 3)}...` : str;\n    },\n    // 上传书籍\n    uploadFile(files) {\n      if (files) {\n        let uploadInstance = UserFiles.insert(\n          {\n            file: files[0],\n            meta: {\n              userId: Meteor.userId(),\n            },\n            chunkSize: \"dynamic\",\n            allowWebWorkers: true,\n          },\n          false\n        );\n        uploadInstance.on(\"uploaded\", (error, fileObj) => {\n          if (error) {\n            return;\n          }\n          if (window.FileReader) {\n            // 将文件转换成Epub格式的文件\n            this.getMd5WithBrowser(files[0], fileObj._id);\n          }\n        });\n        uploadInstance.on(\"error\", (error, fileObj) => {\n          alert(error);\n        });\n        uploadInstance.start();\n      }\n    },\n    // 转化为File格式的文件\n    getMd5WithBrowser(file, id) {\n      return new Promise((resolve, reject) => {\n        var blobSlice =\n            File.prototype.slice ||\n            File.prototype.mozSlice ||\n            File.prototype.webkitSlice,\n          chunkSize = 2097152, // 以每片2MB大小来逐次读取\n          chunks = Math.ceil(file.size / chunkSize),\n          currentChunk = 0,\n          spark = new SparkMD5(), //创建SparkMD5的实例\n          fileReader = new FileReader();\n        fileReader.onload = async (e) => {\n          if (!e.target) {\n            reject();\n            throw new Error();\n          }\n          spark.appendBinary(e.target.result); // append array buffer\n          currentChunk += 1;\n          if (currentChunk < chunks) {\n            loadNext();\n          } else {\n            let md5 = spark.end(); // 完成计算，返回结果\n            await this.handleBook(file, md5, id);\n            resolve();\n          }\n        };\n\n        const loadNext = () => {\n          var start = currentChunk * chunkSize,\n            end =\n              start + chunkSize >= file.size ? file.size : start + chunkSize;\n          fileReader.readAsBinaryString(blobSlice.call(file, start, end));\n        };\n\n        loadNext();\n      });\n    },\n    // 处理文件\n    handleBook(file, md5, id) {\n      let extension = file.name.split(\".\").reverse()[0];\n      let bookName = file.name.substr(\n        0,\n        file.name.length - extension.length - 1\n      );\n      return new Promise((resolve, reject) => {\n        Meteor.call(\n          \"books.find\",\n          {\n            md5,\n            name: bookName,\n          },\n          (err, result) => {\n            if (err) {\n              return this.$message.error(err);\n            }\n            if (result.length !== 0) {\n              return this.$message.error(\"书籍名已经存在\");\n            }\n            let reader = new FileReader();\n            reader.readAsArrayBuffer(file);\n            reader.onload = async (e) => {\n              if (!e.target) {\n                reject();\n                throw new Error();\n              }\n              let cover = \"\";\n              const epub = ePub(e.target.result, \"binary\");\n              epub.loaded.metadata\n                .then((metadata) => {\n                  if (!e.target) {\n                    reject();\n                    throw new Error();\n                  }\n                  epub\n                    .coverUrl()\n                    .then(async (url) => {\n                      if (url) {\n                        var reader = new FileReader();\n                        let blob = await fetch(url).then((r) => r.blob());\n                        reader.readAsDataURL(blob);\n                        reader.onloadend = async () => {\n                          cover = reader.result;\n                          let key, name, author, description, publisher;\n                          [name, author, description, publisher] = [\n                            metadata.title,\n                            metadata.creator,\n                            metadata.description,\n                            metadata.publisher,\n                          ];\n                          let format = \"EPUB\";\n                          key = new Date().getTime() + \"\";\n\n                          let book = new BookModel(\n                            key,\n                            name,\n                            author,\n                            description,\n                            md5,\n                            cover,\n                            format,\n                            publisher\n                          );\n                          console.log(\"key\");\n                          this.handleAddBook(book, id);\n                          resolve();\n                        };\n                      } else {\n                        cover = \"noCover\";\n                        let key, name, author, publisher, description;\n                        [name, author, description, publisher] = [\n                          metadata.title,\n                          metadata.creator,\n                          metadata.description,\n                          metadata.publisher,\n                        ];\n                        let format = \"EPUB\";\n                        key = new Date().getTime() + \"\";\n                        let book = new BookModel(\n                          key,\n                          name,\n                          author,\n                          description,\n                          md5,\n                          cover,\n                          format,\n                          publisher\n                        );\n                        this.handleAddBook(book, id);\n                        // BookUtil.addBook(key, e.target\n                        //   .result);\n                        resolve();\n                      }\n                    })\n                    .catch((err) => {\n                      console.log(err, \"err\");\n                      reject();\n                    });\n                })\n                .catch(() => {\n                  console.log(\"Error occurs\");\n                  reject();\n                });\n            };\n          }\n        );\n      });\n    },\n    // 添加Book到数据库\n    handleAddBook(book, id) {\n      return new Promise((resolve, reject) => {\n        Meteor.call(\n          \"books.add\",\n          {\n            fileId: id,\n            ...book,\n          },\n          (err, res) => {\n            if (err) {\n              return this.$message.error(err);\n            }\n            this.book = book;\n            this.$emit(\"input\", res);\n            this.$message.success(\"添加成功成功\");\n          }\n        );\n      });\n    },\n  },\n};\n"]},"sourceType":"module","hash":"09bf5e76ff8fdaf0c3f8c151c3857955e930b70f"}
