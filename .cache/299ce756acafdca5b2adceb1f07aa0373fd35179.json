{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/imports/ui/components/ImageCropper/index.vue","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions",["flow",{}],"nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"jsx","jsx","jsx","jsx","jsx"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"sourceFileName":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/imports/ui/components/ImageCropper/index.vue","filename":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/imports/ui/components/ImageCropper/index.vue","passPerPreset":false,"envName":"development","cwd":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui","root":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.7.6","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":{},"_verified":{},"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"TSModuleBlock":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}},{"key":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/node_modules/@vue/babel-preset-jsx/dist/plugin.cjs.js$0","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/node_modules/@vue/babel-preset-jsx/dist/plugin.cjs.js$1","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/node_modules/@vue/babel-preset-jsx/dist/plugin.cjs.js$2","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/node_modules/@vue/babel-preset-jsx/dist/plugin.cjs.js$3","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"babel-plugin-transform-vue-jsx","visitor":{"_exploded":{},"_verified":{},"JSXElement":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/imports/ui/components/ImageCropper/index.vue","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/imports/ui/components/ImageCropper/index.vue"}},"code":"\"use strict\"; // import request from '@/utils/request'\n\nvar language;\nmodule.link(\"./utils/language.js\", {\n  \"default\": function (v) {\n    language = v;\n  }\n}, 0);\nvar mimes;\nmodule.link(\"./utils/mimes.js\", {\n  \"default\": function (v) {\n    mimes = v;\n  }\n}, 1);\nvar data2blob;\nmodule.link(\"./utils/data2blob.js\", {\n  \"default\": function (v) {\n    data2blob = v;\n  }\n}, 2);\nvar effectRipple;\nmodule.link(\"./utils/effectRipple.js\", {\n  \"default\": function (v) {\n    effectRipple = v;\n  }\n}, 3);\nvar Images;\nmodule.link(\"../../../features/images/app/collections\", {\n  \"default\": function (v) {\n    Images = v;\n  }\n}, 4);\nmodule.exportDefault({\n  props: {\n    // 域，上传文件name，触发事件会带上（如果一个页面多个图片上传控件，可以做区分\n    field: {\n      type: String,\n      \"default\": \"avatar\"\n    },\n    // 原名key，类似于id，触发事件会带上（如果一个页面多个图片上传控件，可以做区分\n    ki: {\n      type: Number,\n      \"default\": 0\n    },\n    // 显示该控件与否\n    value: {\n      type: Boolean,\n      \"default\": true\n    },\n    // 上传地址\n    url: {\n      type: String,\n      \"default\": \"\"\n    },\n    // 其他要上传文件附带的数据，对象格式\n    params: {\n      type: Object,\n      \"default\": null\n    },\n    // Add custom headers\n    headers: {\n      type: Object,\n      \"default\": null\n    },\n    // 剪裁图片的宽\n    width: {\n      type: Number,\n      \"default\": 200\n    },\n    // 剪裁图片的高\n    height: {\n      type: Number,\n      \"default\": 200\n    },\n    // 不显示旋转功能\n    noRotate: {\n      type: Boolean,\n      \"default\": true\n    },\n    // 不预览圆形图片\n    noCircle: {\n      type: Boolean,\n      \"default\": false\n    },\n    // 不预览方形图片\n    noSquare: {\n      type: Boolean,\n      \"default\": false\n    },\n    // 单文件大小限制\n    maxSize: {\n      type: Number,\n      \"default\": 10240\n    },\n    // 语言类型\n    langType: {\n      type: String,\n      \"default\": \"zh\"\n    },\n    // 语言包\n    langExt: {\n      type: Object,\n      \"default\": null\n    },\n    // 图片上传格式\n    imgFormat: {\n      type: String,\n      \"default\": \"png\"\n    },\n    // 是否支持跨域\n    withCredentials: {\n      type: Boolean,\n      \"default\": false\n    }\n  },\n  data: function () {\n    var imgFormat = this.imgFormat,\n        langType = this.langType,\n        langExt = this.langExt,\n        width = this.width,\n        height = this.height;\n    var isSupported = true;\n    var allowImgFormat = [\"jpg\", \"png\"];\n    var tempImgFormat = allowImgFormat.indexOf(imgFormat) === -1 ? \"jpg\" : imgFormat;\n    var lang = language[langType] ? language[langType] : language[\"en\"];\n    var mime = mimes[tempImgFormat]; // 规范图片格式\n\n    this.imgFormat = tempImgFormat;\n\n    if (langExt) {\n      Object.assign(lang, langExt);\n    }\n\n    if (typeof FormData !== \"function\") {\n      isSupported = false;\n    }\n\n    return {\n      // 图片的mime\n      mime: mime,\n      // 语言包\n      lang: lang,\n      // 浏览器是否支持该控件\n      isSupported: isSupported,\n      // 浏览器是否支持触屏事件\n      // eslint-disable-next-line no-prototype-builtins\n      isSupportTouch: document.hasOwnProperty(\"ontouchstart\"),\n      // 步骤\n      step: 1,\n      // 1选择文件 2剪裁 3上传\n      // 上传状态及进度\n      loading: 0,\n      // 0未开始 1正在 2成功 3错误\n      progress: 0,\n      // 是否有错误及错误信息\n      hasError: false,\n      errorMsg: \"\",\n      // 需求图宽高比\n      ratio: width / height,\n      // 原图地址、生成图片地址\n      sourceImg: null,\n      sourceImgUrl: \"\",\n      createImgUrl: \"\",\n      // 原图片拖动事件初始值\n      sourceImgMouseDown: {\n        on: false,\n        mX: 0,\n        // 鼠标按下的坐标\n        mY: 0,\n        x: 0,\n        // scale原图坐标\n        y: 0\n      },\n      // 生成图片预览的容器大小\n      previewContainer: {\n        width: 100,\n        height: 100\n      },\n      // 原图容器宽高\n      sourceImgContainer: {\n        // sic\n        width: 240,\n        height: 184 // 如果生成图比例与此一致会出现bug，先改成特殊的格式吧，哈哈哈\n\n      },\n      // 原图展示属性\n      scale: {\n        zoomAddOn: false,\n        // 按钮缩放事件开启\n        zoomSubOn: false,\n        // 按钮缩放事件开启\n        range: 1,\n        // 最大100\n        rotateLeft: false,\n        // 按钮向左旋转事件开启\n        rotateRight: false,\n        // 按钮向右旋转事件开启\n        degree: 0,\n        // 旋转度数\n        x: 0,\n        y: 0,\n        width: 0,\n        height: 0,\n        maxWidth: 0,\n        maxHeight: 0,\n        minWidth: 0,\n        // 最宽\n        minHeight: 0,\n        naturalWidth: 0,\n        // 原宽\n        naturalHeight: 0\n      }\n    };\n  },\n  computed: {\n    // 进度条样式\n    progressStyle: function () {\n      var progress = this.progress;\n      return {\n        width: progress + \"%\"\n      };\n    },\n    // 原图样式\n    sourceImgStyle: function () {\n      var scale = this.scale,\n          sourceImgMasking = this.sourceImgMasking;\n      var top = scale.y + sourceImgMasking.y + \"px\";\n      var left = scale.x + sourceImgMasking.x + \"px\";\n      return {\n        top: top,\n        left: left,\n        width: scale.width + \"px\",\n        height: scale.height + \"px\",\n        transform: \"rotate(\" + scale.degree + \"deg)\",\n        // 旋转时 左侧原始图旋转样式\n        \"-ms-transform\": \"rotate(\" + scale.degree + \"deg)\",\n        // 兼容IE9\n        \"-moz-transform\": \"rotate(\" + scale.degree + \"deg)\",\n        // 兼容FireFox\n        \"-webkit-transform\": \"rotate(\" + scale.degree + \"deg)\",\n        // 兼容Safari 和 chrome\n        \"-o-transform\": \"rotate(\" + scale.degree + \"deg)\" // 兼容 Opera\n\n      };\n    },\n    // 原图蒙版属性\n    sourceImgMasking: function () {\n      var width = this.width,\n          height = this.height,\n          ratio = this.ratio,\n          sourceImgContainer = this.sourceImgContainer;\n      var sic = sourceImgContainer;\n      var sicRatio = sic.width / sic.height; // 原图容器宽高比\n\n      var x = 0;\n      var y = 0;\n      var w = sic.width;\n      var h = sic.height;\n      var scale = 1;\n\n      if (ratio < sicRatio) {\n        scale = sic.height / height;\n        w = sic.height * ratio;\n        x = (sic.width - w) / 2;\n      }\n\n      if (ratio > sicRatio) {\n        scale = sic.width / width;\n        h = sic.width / ratio;\n        y = (sic.height - h) / 2;\n      }\n\n      return {\n        scale: scale,\n        // 蒙版相对需求宽高的缩放\n        x: x,\n        y: y,\n        width: w,\n        height: h\n      };\n    },\n    // 原图遮罩样式\n    sourceImgShadeStyle: function () {\n      var sourceImgMasking = this.sourceImgMasking,\n          sourceImgContainer = this.sourceImgContainer;\n      var sic = sourceImgContainer;\n      var sim = sourceImgMasking;\n      var w = sim.width === sic.width ? sim.width : (sic.width - sim.width) / 2;\n      var h = sim.height === sic.height ? sim.height : (sic.height - sim.height) / 2;\n      return {\n        width: w + \"px\",\n        height: h + \"px\"\n      };\n    },\n    previewStyle: function () {\n      var ratio = this.ratio,\n          previewContainer = this.previewContainer;\n      var pc = previewContainer;\n      var w = pc.width;\n      var h = pc.height;\n      var pcRatio = w / h;\n\n      if (ratio < pcRatio) {\n        w = pc.height * ratio;\n      }\n\n      if (ratio > pcRatio) {\n        h = pc.width / ratio;\n      }\n\n      return {\n        width: w + \"px\",\n        height: h + \"px\"\n      };\n    }\n  },\n  watch: {\n    value: function (newValue) {\n      if (newValue && this.loading !== 1) {\n        this.reset();\n      }\n    }\n  },\n  created: function () {\n    // 绑定按键esc隐藏此插件事件\n    document.addEventListener(\"keyup\", this.closeHandler);\n  },\n  destroyed: function () {\n    document.removeEventListener(\"keyup\", this.closeHandler);\n  },\n  methods: {\n    // 点击波纹效果\n    ripple: function (e) {\n      effectRipple(e);\n    },\n    // 关闭控件\n    off: function () {\n      var _this = this;\n\n      setTimeout(function () {\n        _this.$emit(\"input\", false);\n\n        _this.$emit(\"close\");\n\n        if (_this.step === 3 && _this.loading === 2) {\n          _this.setStep(1);\n        }\n      }, 200);\n    },\n    // 设置步骤\n    setStep: function (no) {\n      var _this2 = this;\n\n      // 延时是为了显示动画效果呢，哈哈哈\n      setTimeout(function () {\n        _this2.step = no;\n      }, 200);\n    },\n\n    /* 图片选择区域函数绑定\n     ---------------------------------------------------------------*/\n    preventDefault: function (e) {\n      e.preventDefault();\n      return false;\n    },\n    handleClick: function (e) {\n      if (this.loading !== 1) {\n        if (e.target !== this.$refs.fileinput) {\n          e.preventDefault();\n\n          if (document.activeElement !== this.$refs) {\n            this.$refs.fileinput.click();\n          }\n        }\n      }\n    },\n    handleChange: function (e) {\n      e.preventDefault();\n\n      if (this.loading !== 1) {\n        var files = e.target.files || e.dataTransfer.files;\n        this.reset();\n\n        if (this.checkFile(files[0])) {\n          this.setSourceImg(files[0]);\n        }\n      }\n    },\n\n    /* ---------------------------------------------------------------*/\n    // 检测选择的文件是否合适\n    checkFile: function (file) {\n      var lang = this.lang,\n          maxSize = this.maxSize; // 仅限图片\n\n      if (file.type.indexOf(\"image\") === -1) {\n        this.hasError = true;\n        this.errorMsg = lang.error.onlyImg;\n        return false;\n      } // 超出大小\n\n\n      if (file.size / 1024 > maxSize) {\n        this.hasError = true;\n        this.errorMsg = lang.error.outOfSize + maxSize + \"kb\";\n        return false;\n      }\n\n      return true;\n    },\n    // 重置控件\n    reset: function () {\n      this.loading = 0;\n      this.hasError = false;\n      this.errorMsg = \"\";\n      this.progress = 0;\n    },\n    // 设置图片源\n    setSourceImg: function (file) {\n      var _this3 = this;\n\n      var fr = new FileReader();\n\n      fr.onload = function (e) {\n        _this3.sourceImgUrl = fr.result;\n\n        _this3.startCrop();\n      };\n\n      fr.readAsDataURL(file);\n    },\n    // 剪裁前准备工作\n    startCrop: function () {\n      var _this4 = this;\n\n      var width = this.width,\n          height = this.height,\n          ratio = this.ratio,\n          scale = this.scale,\n          sourceImgUrl = this.sourceImgUrl,\n          sourceImgMasking = this.sourceImgMasking,\n          lang = this.lang;\n      var sim = sourceImgMasking;\n      var img = new Image();\n      img.src = sourceImgUrl;\n\n      img.onload = function () {\n        var nWidth = img.naturalWidth;\n        var nHeight = img.naturalHeight;\n        var nRatio = nWidth / nHeight;\n        var w = sim.width;\n        var h = sim.height;\n        var x = 0;\n        var y = 0; // 图片像素不达标\n\n        if (nWidth < width || nHeight < height) {\n          _this4.hasError = true;\n          _this4.errorMsg = lang.error.lowestPx + width + \"*\" + height;\n          return false;\n        }\n\n        if (ratio > nRatio) {\n          h = w / nRatio;\n          y = (sim.height - h) / 2;\n        }\n\n        if (ratio < nRatio) {\n          w = h * nRatio;\n          x = (sim.width - w) / 2;\n        }\n\n        scale.range = 0;\n        scale.x = x;\n        scale.y = y;\n        scale.width = w;\n        scale.height = h;\n        scale.degree = 0;\n        scale.minWidth = w;\n        scale.minHeight = h;\n        scale.maxWidth = nWidth * sim.scale;\n        scale.maxHeight = nHeight * sim.scale;\n        scale.naturalWidth = nWidth;\n        scale.naturalHeight = nHeight;\n        _this4.sourceImg = img;\n\n        _this4.createImg();\n\n        _this4.setStep(2);\n      };\n    },\n    // 鼠标按下图片准备移动\n    imgStartMove: function (e) {\n      e.preventDefault(); // 支持触摸事件，则鼠标事件无效\n\n      if (this.isSupportTouch && !e.targetTouches) {\n        return false;\n      }\n\n      var et = e.targetTouches ? e.targetTouches[0] : e;\n      var sourceImgMouseDown = this.sourceImgMouseDown,\n          scale = this.scale;\n      var simd = sourceImgMouseDown;\n      simd.mX = et.screenX;\n      simd.mY = et.screenY;\n      simd.x = scale.x;\n      simd.y = scale.y;\n      simd.on = true;\n    },\n    // 鼠标按下状态下移动，图片移动\n    imgMove: function (e) {\n      e.preventDefault(); // 支持触摸事件，则鼠标事件无效\n\n      if (this.isSupportTouch && !e.targetTouches) {\n        return false;\n      }\n\n      var et = e.targetTouches ? e.targetTouches[0] : e;\n      var _this$sourceImgMouseD = this.sourceImgMouseDown,\n          on = _this$sourceImgMouseD.on,\n          mX = _this$sourceImgMouseD.mX,\n          mY = _this$sourceImgMouseD.mY,\n          x = _this$sourceImgMouseD.x,\n          y = _this$sourceImgMouseD.y,\n          scale = this.scale,\n          sourceImgMasking = this.sourceImgMasking;\n      var sim = sourceImgMasking;\n      var nX = et.screenX;\n      var nY = et.screenY;\n      var dX = nX - mX;\n      var dY = nY - mY;\n      var rX = x + dX;\n      var rY = y + dY;\n      if (!on) return;\n\n      if (rX > 0) {\n        rX = 0;\n      }\n\n      if (rY > 0) {\n        rY = 0;\n      }\n\n      if (rX < sim.width - scale.width) {\n        rX = sim.width - scale.width;\n      }\n\n      if (rY < sim.height - scale.height) {\n        rY = sim.height - scale.height;\n      }\n\n      scale.x = rX;\n      scale.y = rY;\n    },\n    // 按钮按下开始向右旋转\n    startRotateRight: function (e) {\n      var _this5 = this;\n\n      var scale = this.scale;\n      scale.rotateRight = true;\n\n      var rotate = function () {\n        if (scale.rotateRight) {\n          var degree = ++scale.degree;\n\n          _this5.createImg(degree);\n\n          setTimeout(function () {\n            rotate();\n          }, 60);\n        }\n      };\n\n      rotate();\n    },\n    // 按钮按下开始向左旋转\n    startRotateLeft: function (e) {\n      var _this6 = this;\n\n      var scale = this.scale;\n      scale.rotateLeft = true;\n\n      var rotate = function () {\n        if (scale.rotateLeft) {\n          var degree = --scale.degree;\n\n          _this6.createImg(degree);\n\n          setTimeout(function () {\n            rotate();\n          }, 60);\n        }\n      };\n\n      rotate();\n    },\n    // 停止旋转\n    endRotate: function () {\n      var scale = this.scale;\n      scale.rotateLeft = false;\n      scale.rotateRight = false;\n    },\n    // 按钮按下开始放大\n    startZoomAdd: function (e) {\n      var _this7 = this;\n\n      var scale = this.scale;\n      scale.zoomAddOn = true;\n\n      var zoom = function () {\n        if (scale.zoomAddOn) {\n          var range = scale.range >= 100 ? 100 : ++scale.range;\n\n          _this7.zoomImg(range);\n\n          setTimeout(function () {\n            zoom();\n          }, 60);\n        }\n      };\n\n      zoom();\n    },\n    // 按钮松开或移开取消放大\n    endZoomAdd: function (e) {\n      this.scale.zoomAddOn = false;\n    },\n    // 按钮按下开始缩小\n    startZoomSub: function (e) {\n      var _this8 = this;\n\n      var scale = this.scale;\n      scale.zoomSubOn = true;\n\n      var zoom = function () {\n        if (scale.zoomSubOn) {\n          var range = scale.range <= 0 ? 0 : --scale.range;\n\n          _this8.zoomImg(range);\n\n          setTimeout(function () {\n            zoom();\n          }, 60);\n        }\n      };\n\n      zoom();\n    },\n    // 按钮松开或移开取消缩小\n    endZoomSub: function (e) {\n      var scale = this.scale;\n      scale.zoomSubOn = false;\n    },\n    zoomChange: function (e) {\n      this.zoomImg(e.target.value);\n    },\n    // 缩放原图\n    zoomImg: function (newRange) {\n      var _this9 = this;\n\n      var sourceImgMasking = this.sourceImgMasking,\n          scale = this.scale;\n      var maxWidth = scale.maxWidth,\n          maxHeight = scale.maxHeight,\n          minWidth = scale.minWidth,\n          minHeight = scale.minHeight,\n          width = scale.width,\n          height = scale.height,\n          x = scale.x,\n          y = scale.y;\n      var sim = sourceImgMasking; // 蒙版宽高\n\n      var sWidth = sim.width;\n      var sHeight = sim.height; // 新宽高\n\n      var nWidth = minWidth + (maxWidth - minWidth) * newRange / 100;\n      var nHeight = minHeight + (maxHeight - minHeight) * newRange / 100; // 新坐标（根据蒙版中心点缩放）\n\n      var nX = sWidth / 2 - nWidth / width * (sWidth / 2 - x);\n      var nY = sHeight / 2 - nHeight / height * (sHeight / 2 - y); // 判断新坐标是否超过蒙版限制\n\n      if (nX > 0) {\n        nX = 0;\n      }\n\n      if (nY > 0) {\n        nY = 0;\n      }\n\n      if (nX < sWidth - nWidth) {\n        nX = sWidth - nWidth;\n      }\n\n      if (nY < sHeight - nHeight) {\n        nY = sHeight - nHeight;\n      } // 赋值处理\n\n\n      scale.x = nX;\n      scale.y = nY;\n      scale.width = nWidth;\n      scale.height = nHeight;\n      scale.range = newRange;\n      setTimeout(function () {\n        if (scale.range === newRange) {\n          _this9.createImg();\n        }\n      }, 300);\n    },\n    // 生成需求图片\n    createImg: function (e) {\n      var mime = this.mime,\n          sourceImg = this.sourceImg,\n          _this$scale = this.scale,\n          x = _this$scale.x,\n          y = _this$scale.y,\n          width = _this$scale.width,\n          height = _this$scale.height,\n          degree = _this$scale.degree,\n          scale = this.sourceImgMasking.scale;\n      var canvas = this.$refs.canvas;\n      var ctx = canvas.getContext(\"2d\");\n\n      if (e) {\n        // 取消鼠标按下移动状态\n        this.sourceImgMouseDown.on = false;\n      }\n\n      canvas.width = this.width;\n      canvas.height = this.height;\n      ctx.clearRect(0, 0, this.width, this.height); // 将透明区域设置为白色底边\n\n      ctx.fillStyle = \"#fff\";\n      ctx.fillRect(0, 0, this.width, this.height);\n      ctx.translate(this.width * 0.5, this.height * 0.5);\n      ctx.rotate(Math.PI * degree / 180);\n      ctx.translate(-this.width * 0.5, -this.height * 0.5);\n      ctx.drawImage(sourceImg, x / scale, y / scale, width / scale, height / scale);\n      this.createImgUrl = canvas.toDataURL(mime);\n    },\n    prepareUpload: function () {\n      var url = this.url,\n          createImgUrl = this.createImgUrl,\n          field = this.field,\n          ki = this.ki;\n      this.$emit(\"crop-success\", createImgUrl, field, ki);\n\n      if (typeof url === \"string\" && url) {\n        this.upload();\n      } else {\n        this.off();\n      }\n    },\n    // 上传图片\n    upload: function () {\n      var lang = this.lang,\n          imgFormat = this.imgFormat,\n          mime = this.mime,\n          url = this.url,\n          params = this.params,\n          field = this.field,\n          ki = this.ki,\n          createImgUrl = this.createImgUrl;\n      var fmData = new FormData(); // fmData.append(\n      //   field,\n      //   data2blob(createImgUrl, mime),\n      //   field + \".\" + imgFormat\n      // );\n      // // 添加其他参数\n      // if (typeof params === \"object\" && params) {\n      //   Object.keys(params).forEach((k) => {\n      //     fmData.append(k, params[k]);\n      //   });\n      // }\n      // 监听进度回调\n      // const uploadProgress = (event) => {\n      //   if (event.lengthComputable) {\n      //     this.progress = (100 * Math.round(event.loaded)) / event.total;\n      //   }\n      // };\n      // 上传文件\n\n      this.reset();\n      this.loading = 1;\n      this.setStep(3);\n      this.loading = 2; // debugger;\n\n      this.$emit(\"crop-upload-success\", {\n        files: {\n          avatar: createImgUrl\n        }\n      }); // debugger;\n      // let uploadInstance = Images.insert(\n      //   {\n      //     file: createImgUrl,\n      //     isBase64: true,\n      //     fileName: field + \".\" + imgFormat,\n      //     // meta: {\n      //     //   userId: Meteor.userId(),\n      //     // },\n      //     chunkSize: \"dynamic\",\n      //     allowWebWorkers: true,\n      //   },\n      //   false\n      // );\n      // uploadInstance.on(\"uploaded\", (error, fileObj) => {\n      //   if (error) {\n      //     return;\n      //   }\n      //   this.loading = 2;\n      //   // debugger;\n      //   this.$emit(\"crop-upload-success\", {\n      //     files:{\n      //       avatar: createImgUrl\n      //     }\n      //   });\n      // });\n      // uploadInstance.on(\"error\", (err) => {\n      //   if (this.value) {\n      //     this.loading = 3;\n      //     this.hasError = true;\n      //     this.errorMsg = lang.fail;\n      //     this.$emit(\"crop-upload-fail\", err, field, ki);\n      //   }\n      // });\n      // uploadInstance.start();\n    },\n    closeHandler: function (e) {\n      if (this.value && (e.key === \"Escape\" || e.keyCode === 27)) {\n        this.off();\n      }\n    }\n  }\n});","map":{"version":3,"sources":["/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/imports/ui/components/ImageCropper/index.vue"],"names":["language","module","link","v","mimes","data2blob","effectRipple","Images","exportDefault","props","field","type","String","ki","Number","value","Boolean","url","params","Object","headers","width","height","noRotate","noCircle","noSquare","maxSize","langType","langExt","imgFormat","withCredentials","data","isSupported","allowImgFormat","tempImgFormat","indexOf","lang","mime","assign","FormData","isSupportTouch","document","hasOwnProperty","step","loading","progress","hasError","errorMsg","ratio","sourceImg","sourceImgUrl","createImgUrl","sourceImgMouseDown","on","mX","mY","x","y","previewContainer","sourceImgContainer","scale","zoomAddOn","zoomSubOn","range","rotateLeft","rotateRight","degree","maxWidth","maxHeight","minWidth","minHeight","naturalWidth","naturalHeight","computed","progressStyle","sourceImgStyle","sourceImgMasking","top","left","transform","sic","sicRatio","w","h","sourceImgShadeStyle","sim","previewStyle","pc","pcRatio","watch","newValue","reset","created","addEventListener","closeHandler","destroyed","removeEventListener","methods","ripple","e","off","setTimeout","$emit","setStep","no","preventDefault","handleClick","target","$refs","fileinput","activeElement","click","handleChange","files","dataTransfer","checkFile","setSourceImg","file","error","onlyImg","size","outOfSize","fr","FileReader","onload","result","startCrop","readAsDataURL","img","Image","src","nWidth","nHeight","nRatio","lowestPx","createImg","imgStartMove","targetTouches","et","simd","screenX","screenY","imgMove","nX","nY","dX","dY","rX","rY","startRotateRight","rotate","startRotateLeft","endRotate","startZoomAdd","zoom","zoomImg","endZoomAdd","startZoomSub","endZoomSub","zoomChange","newRange","sWidth","sHeight","canvas","ctx","getContext","clearRect","fillStyle","fillRect","translate","Math","PI","drawImage","toDataURL","prepareUpload","upload","fmData","avatar","key","keyCode"],"mappings":"AACA,a,CACA;;AAFA,IAAIA,QAAJ;AAAaC,MAAM,CAACC,IAAP,CAAY,qBAAZ,EAAkC;AAAC,aAAQ,UAASC,CAAT,EAAW;AAACH,IAAAA,QAAQ,GAACG,CAAT;AAAW;AAAhC,CAAlC,EAAoE,CAApE;AAAuE,IAAIC,KAAJ;AAAUH,MAAM,CAACC,IAAP,CAAY,kBAAZ,EAA+B;AAAC,aAAQ,UAASC,CAAT,EAAW;AAACC,IAAAA,KAAK,GAACD,CAAN;AAAQ;AAA7B,CAA/B,EAA8D,CAA9D;AAAiE,IAAIE,SAAJ;AAAcJ,MAAM,CAACC,IAAP,CAAY,sBAAZ,EAAmC;AAAC,aAAQ,UAASC,CAAT,EAAW;AAACE,IAAAA,SAAS,GAACF,CAAV;AAAY;AAAjC,CAAnC,EAAsE,CAAtE;AAAyE,IAAIG,YAAJ;AAAiBL,MAAM,CAACC,IAAP,CAAY,yBAAZ,EAAsC;AAAC,aAAQ,UAASC,CAAT,EAAW;AAACG,IAAAA,YAAY,GAACH,CAAb;AAAe;AAApC,CAAtC,EAA4E,CAA5E;AAA+E,IAAII,MAAJ;AAAWN,MAAM,CAACC,IAAP,CAAY,0CAAZ,EAAuD;AAAC,aAAQ,UAASC,CAAT,EAAW;AAACI,IAAAA,MAAM,GAACJ,CAAP;AAAS;AAA9B,CAAvD,EAAuF,CAAvF;AAAjWF,MAAM,CAACO,aAAP,CAQe;AACbC,EAAAA,KAAK,EAAE;AACL;AACAC,IAAAA,KAAK,EAAE;AACLC,MAAAA,IAAI,EAAEC,MADD;AAEL,iBAAS;AAFJ,KAFF;AAML;AACAC,IAAAA,EAAE,EAAE;AACFF,MAAAA,IAAI,EAAEG,MADJ;AAEF,iBAAS;AAFP,KAPC;AAWL;AACAC,IAAAA,KAAK,EAAE;AACLJ,MAAAA,IAAI,EAAEK,OADD;AAEL,iBAAS;AAFJ,KAZF;AAgBL;AACAC,IAAAA,GAAG,EAAE;AACHN,MAAAA,IAAI,EAAEC,MADH;AAEH,iBAAS;AAFN,KAjBA;AAqBL;AACAM,IAAAA,MAAM,EAAE;AACNP,MAAAA,IAAI,EAAEQ,MADA;AAEN,iBAAS;AAFH,KAtBH;AA0BL;AACAC,IAAAA,OAAO,EAAE;AACPT,MAAAA,IAAI,EAAEQ,MADC;AAEP,iBAAS;AAFF,KA3BJ;AA+BL;AACAE,IAAAA,KAAK,EAAE;AACLV,MAAAA,IAAI,EAAEG,MADD;AAEL,iBAAS;AAFJ,KAhCF;AAoCL;AACAQ,IAAAA,MAAM,EAAE;AACNX,MAAAA,IAAI,EAAEG,MADA;AAEN,iBAAS;AAFH,KArCH;AAyCL;AACAS,IAAAA,QAAQ,EAAE;AACRZ,MAAAA,IAAI,EAAEK,OADE;AAER,iBAAS;AAFD,KA1CL;AA8CL;AACAQ,IAAAA,QAAQ,EAAE;AACRb,MAAAA,IAAI,EAAEK,OADE;AAER,iBAAS;AAFD,KA/CL;AAmDL;AACAS,IAAAA,QAAQ,EAAE;AACRd,MAAAA,IAAI,EAAEK,OADE;AAER,iBAAS;AAFD,KApDL;AAwDL;AACAU,IAAAA,OAAO,EAAE;AACPf,MAAAA,IAAI,EAAEG,MADC;AAEP,iBAAS;AAFF,KAzDJ;AA6DL;AACAa,IAAAA,QAAQ,EAAE;AACRhB,MAAAA,IAAI,EAAEC,MADE;AAER,iBAAS;AAFD,KA9DL;AAkEL;AACAgB,IAAAA,OAAO,EAAE;AACPjB,MAAAA,IAAI,EAAEQ,MADC;AAEP,iBAAS;AAFF,KAnEJ;AAuEL;AACAU,IAAAA,SAAS,EAAE;AACTlB,MAAAA,IAAI,EAAEC,MADG;AAET,iBAAS;AAFA,KAxEN;AA4EL;AACAkB,IAAAA,eAAe,EAAE;AACfnB,MAAAA,IAAI,EAAEK,OADS;AAEf,iBAAS;AAFM;AA7EZ,GADM;AAmFbe,EAAAA,IAnFa,cAmFN;AAAA,QACGF,SADH,GACmD,IADnD,CACGA,SADH;AAAA,QACcF,QADd,GACmD,IADnD,CACcA,QADd;AAAA,QACwBC,OADxB,GACmD,IADnD,CACwBA,OADxB;AAAA,QACiCP,KADjC,GACmD,IADnD,CACiCA,KADjC;AAAA,QACwCC,MADxC,GACmD,IADnD,CACwCA,MADxC;AAEL,QAAIU,WAAW,GAAG,IAAlB;AACA,QAAMC,cAAc,GAAG,CAAC,KAAD,EAAQ,KAAR,CAAvB;AACA,QAAMC,aAAa,GACjBD,cAAc,CAACE,OAAf,CAAuBN,SAAvB,MAAsC,CAAC,CAAvC,GAA2C,KAA3C,GAAmDA,SADrD;AAEA,QAAMO,IAAI,GAAGpC,QAAQ,CAAC2B,QAAD,CAAR,GAAqB3B,QAAQ,CAAC2B,QAAD,CAA7B,GAA0C3B,QAAQ,CAAC,IAAD,CAA/D;AACA,QAAMqC,IAAI,GAAGjC,KAAK,CAAC8B,aAAD,CAAlB,CAPK,CAQL;;AACA,SAAKL,SAAL,GAAiBK,aAAjB;;AACA,QAAIN,OAAJ,EAAa;AACXT,MAAAA,MAAM,CAACmB,MAAP,CAAcF,IAAd,EAAoBR,OAApB;AACD;;AACD,QAAI,OAAOW,QAAP,KAAoB,UAAxB,EAAoC;AAClCP,MAAAA,WAAW,GAAG,KAAd;AACD;;AACD,WAAO;AACL;AACAK,MAAAA,IAAI,EAAJA,IAFK;AAGL;AACAD,MAAAA,IAAI,EAAJA,IAJK;AAKL;AACAJ,MAAAA,WAAW,EAAXA,WANK;AAOL;AACA;AACAQ,MAAAA,cAAc,EAAEC,QAAQ,CAACC,cAAT,CAAwB,cAAxB,CATX;AAUL;AACAC,MAAAA,IAAI,EAAE,CAXD;AAWI;AACT;AACAC,MAAAA,OAAO,EAAE,CAbJ;AAaO;AACZC,MAAAA,QAAQ,EAAE,CAdL;AAeL;AACAC,MAAAA,QAAQ,EAAE,KAhBL;AAiBLC,MAAAA,QAAQ,EAAE,EAjBL;AAkBL;AACAC,MAAAA,KAAK,EAAE3B,KAAK,GAAGC,MAnBV;AAoBL;AACA2B,MAAAA,SAAS,EAAE,IArBN;AAsBLC,MAAAA,YAAY,EAAE,EAtBT;AAuBLC,MAAAA,YAAY,EAAE,EAvBT;AAwBL;AACAC,MAAAA,kBAAkB,EAAE;AAClBC,QAAAA,EAAE,EAAE,KADc;AAElBC,QAAAA,EAAE,EAAE,CAFc;AAEX;AACPC,QAAAA,EAAE,EAAE,CAHc;AAIlBC,QAAAA,CAAC,EAAE,CAJe;AAIZ;AACNC,QAAAA,CAAC,EAAE;AALe,OAzBf;AAgCL;AACAC,MAAAA,gBAAgB,EAAE;AAChBrC,QAAAA,KAAK,EAAE,GADS;AAEhBC,QAAAA,MAAM,EAAE;AAFQ,OAjCb;AAqCL;AACAqC,MAAAA,kBAAkB,EAAE;AAClB;AACAtC,QAAAA,KAAK,EAAE,GAFW;AAGlBC,QAAAA,MAAM,EAAE,GAHU,CAGL;;AAHK,OAtCf;AA2CL;AACAsC,MAAAA,KAAK,EAAE;AACLC,QAAAA,SAAS,EAAE,KADN;AACa;AAClBC,QAAAA,SAAS,EAAE,KAFN;AAEa;AAClBC,QAAAA,KAAK,EAAE,CAHF;AAGK;AACVC,QAAAA,UAAU,EAAE,KAJP;AAIc;AACnBC,QAAAA,WAAW,EAAE,KALR;AAKe;AACpBC,QAAAA,MAAM,EAAE,CANH;AAMM;AACXV,QAAAA,CAAC,EAAE,CAPE;AAQLC,QAAAA,CAAC,EAAE,CARE;AASLpC,QAAAA,KAAK,EAAE,CATF;AAULC,QAAAA,MAAM,EAAE,CAVH;AAWL6C,QAAAA,QAAQ,EAAE,CAXL;AAYLC,QAAAA,SAAS,EAAE,CAZN;AAaLC,QAAAA,QAAQ,EAAE,CAbL;AAaQ;AACbC,QAAAA,SAAS,EAAE,CAdN;AAeLC,QAAAA,YAAY,EAAE,CAfT;AAeY;AACjBC,QAAAA,aAAa,EAAE;AAhBV;AA5CF,KAAP;AA+DD,GAlKY;AAmKbC,EAAAA,QAAQ,EAAE;AACR;AACAC,IAAAA,aAFQ,cAEQ;AAAA,UACN7B,QADM,GACO,IADP,CACNA,QADM;AAEd,aAAO;AACLxB,QAAAA,KAAK,EAAEwB,QAAQ,GAAG;AADb,OAAP;AAGD,KAPO;AAQR;AACA8B,IAAAA,cATQ,cASS;AAAA,UACPf,KADO,GACqB,IADrB,CACPA,KADO;AAAA,UACAgB,gBADA,GACqB,IADrB,CACAA,gBADA;AAEf,UAAMC,GAAG,GAAGjB,KAAK,CAACH,CAAN,GAAUmB,gBAAgB,CAACnB,CAA3B,GAA+B,IAA3C;AACA,UAAMqB,IAAI,GAAGlB,KAAK,CAACJ,CAAN,GAAUoB,gBAAgB,CAACpB,CAA3B,GAA+B,IAA5C;AACA,aAAO;AACLqB,QAAAA,GAAG,EAAHA,GADK;AAELC,QAAAA,IAAI,EAAJA,IAFK;AAGLzD,QAAAA,KAAK,EAAEuC,KAAK,CAACvC,KAAN,GAAc,IAHhB;AAILC,QAAAA,MAAM,EAAEsC,KAAK,CAACtC,MAAN,GAAe,IAJlB;AAKLyD,QAAAA,SAAS,EAAE,YAAYnB,KAAK,CAACM,MAAlB,GAA2B,MALjC;AAKyC;AAC9C,yBAAiB,YAAYN,KAAK,CAACM,MAAlB,GAA2B,MANvC;AAM+C;AACpD,0BAAkB,YAAYN,KAAK,CAACM,MAAlB,GAA2B,MAPxC;AAOgD;AACrD,6BAAqB,YAAYN,KAAK,CAACM,MAAlB,GAA2B,MAR3C;AAQmD;AACxD,wBAAgB,YAAYN,KAAK,CAACM,MAAlB,GAA2B,MATtC,CAS8C;;AAT9C,OAAP;AAWD,KAxBO;AAyBR;AACAU,IAAAA,gBA1BQ,cA0BW;AAAA,UACTvD,KADS,GACoC,IADpC,CACTA,KADS;AAAA,UACFC,MADE,GACoC,IADpC,CACFA,MADE;AAAA,UACM0B,KADN,GACoC,IADpC,CACMA,KADN;AAAA,UACaW,kBADb,GACoC,IADpC,CACaA,kBADb;AAEjB,UAAMqB,GAAG,GAAGrB,kBAAZ;AACA,UAAMsB,QAAQ,GAAGD,GAAG,CAAC3D,KAAJ,GAAY2D,GAAG,CAAC1D,MAAjC,CAHiB,CAGwB;;AACzC,UAAIkC,CAAC,GAAG,CAAR;AACA,UAAIC,CAAC,GAAG,CAAR;AACA,UAAIyB,CAAC,GAAGF,GAAG,CAAC3D,KAAZ;AACA,UAAI8D,CAAC,GAAGH,GAAG,CAAC1D,MAAZ;AACA,UAAIsC,KAAK,GAAG,CAAZ;;AACA,UAAIZ,KAAK,GAAGiC,QAAZ,EAAsB;AACpBrB,QAAAA,KAAK,GAAGoB,GAAG,CAAC1D,MAAJ,GAAaA,MAArB;AACA4D,QAAAA,CAAC,GAAGF,GAAG,CAAC1D,MAAJ,GAAa0B,KAAjB;AACAQ,QAAAA,CAAC,GAAG,CAACwB,GAAG,CAAC3D,KAAJ,GAAY6D,CAAb,IAAkB,CAAtB;AACD;;AACD,UAAIlC,KAAK,GAAGiC,QAAZ,EAAsB;AACpBrB,QAAAA,KAAK,GAAGoB,GAAG,CAAC3D,KAAJ,GAAYA,KAApB;AACA8D,QAAAA,CAAC,GAAGH,GAAG,CAAC3D,KAAJ,GAAY2B,KAAhB;AACAS,QAAAA,CAAC,GAAG,CAACuB,GAAG,CAAC1D,MAAJ,GAAa6D,CAAd,IAAmB,CAAvB;AACD;;AACD,aAAO;AACLvB,QAAAA,KAAK,EAALA,KADK;AACE;AACPJ,QAAAA,CAAC,EAADA,CAFK;AAGLC,QAAAA,CAAC,EAADA,CAHK;AAILpC,QAAAA,KAAK,EAAE6D,CAJF;AAKL5D,QAAAA,MAAM,EAAE6D;AALH,OAAP;AAOD,KApDO;AAqDR;AACAC,IAAAA,mBAtDQ,cAsDc;AAAA,UACZR,gBADY,GAC6B,IAD7B,CACZA,gBADY;AAAA,UACMjB,kBADN,GAC6B,IAD7B,CACMA,kBADN;AAEpB,UAAMqB,GAAG,GAAGrB,kBAAZ;AACA,UAAM0B,GAAG,GAAGT,gBAAZ;AACA,UAAMM,CAAC,GACLG,GAAG,CAAChE,KAAJ,KAAc2D,GAAG,CAAC3D,KAAlB,GAA0BgE,GAAG,CAAChE,KAA9B,GAAsC,CAAC2D,GAAG,CAAC3D,KAAJ,GAAYgE,GAAG,CAAChE,KAAjB,IAA0B,CADlE;AAEA,UAAM8D,CAAC,GACLE,GAAG,CAAC/D,MAAJ,KAAe0D,GAAG,CAAC1D,MAAnB,GAA4B+D,GAAG,CAAC/D,MAAhC,GAAyC,CAAC0D,GAAG,CAAC1D,MAAJ,GAAa+D,GAAG,CAAC/D,MAAlB,IAA4B,CADvE;AAEA,aAAO;AACLD,QAAAA,KAAK,EAAE6D,CAAC,GAAG,IADN;AAEL5D,QAAAA,MAAM,EAAE6D,CAAC,GAAG;AAFP,OAAP;AAID,KAlEO;AAmERG,IAAAA,YAnEQ,cAmEO;AAAA,UACLtC,KADK,GACuB,IADvB,CACLA,KADK;AAAA,UACEU,gBADF,GACuB,IADvB,CACEA,gBADF;AAEb,UAAM6B,EAAE,GAAG7B,gBAAX;AACA,UAAIwB,CAAC,GAAGK,EAAE,CAAClE,KAAX;AACA,UAAI8D,CAAC,GAAGI,EAAE,CAACjE,MAAX;AACA,UAAMkE,OAAO,GAAGN,CAAC,GAAGC,CAApB;;AACA,UAAInC,KAAK,GAAGwC,OAAZ,EAAqB;AACnBN,QAAAA,CAAC,GAAGK,EAAE,CAACjE,MAAH,GAAY0B,KAAhB;AACD;;AACD,UAAIA,KAAK,GAAGwC,OAAZ,EAAqB;AACnBL,QAAAA,CAAC,GAAGI,EAAE,CAAClE,KAAH,GAAW2B,KAAf;AACD;;AACD,aAAO;AACL3B,QAAAA,KAAK,EAAE6D,CAAC,GAAG,IADN;AAEL5D,QAAAA,MAAM,EAAE6D,CAAC,GAAG;AAFP,OAAP;AAID;AAnFO,GAnKG;AAwPbM,EAAAA,KAAK,EAAE;AACL1E,IAAAA,KADK,YACC2E,QADD,EACW;AACd,UAAIA,QAAQ,IAAI,KAAK9C,OAAL,KAAiB,CAAjC,EAAoC;AAClC,aAAK+C,KAAL;AACD;AACF;AALI,GAxPM;AA+PbC,EAAAA,OA/Pa,cA+PH;AACR;AACAnD,IAAAA,QAAQ,CAACoD,gBAAT,CAA0B,OAA1B,EAAmC,KAAKC,YAAxC;AACD,GAlQY;AAmQbC,EAAAA,SAnQa,cAmQD;AACVtD,IAAAA,QAAQ,CAACuD,mBAAT,CAA6B,OAA7B,EAAsC,KAAKF,YAA3C;AACD,GArQY;AAsQbG,EAAAA,OAAO,EAAE;AACP;AACAC,IAAAA,MAFO,YAEAC,CAFA,EAEG;AACR7F,MAAAA,YAAY,CAAC6F,CAAD,CAAZ;AACD,KAJM;AAKP;AACAC,IAAAA,GANO,cAMD;AAAA;;AACJC,MAAAA,UAAU,CAAC,YAAM;AACf,QAAA,KAAI,CAACC,KAAL,CAAW,OAAX,EAAoB,KAApB;;AACA,QAAA,KAAI,CAACA,KAAL,CAAW,OAAX;;AACA,YAAI,KAAI,CAAC3D,IAAL,KAAc,CAAd,IAAmB,KAAI,CAACC,OAAL,KAAiB,CAAxC,EAA2C;AACzC,UAAA,KAAI,CAAC2D,OAAL,CAAa,CAAb;AACD;AACF,OANS,EAMP,GANO,CAAV;AAOD,KAdM;AAeP;AACAA,IAAAA,OAhBO,YAgBCC,EAhBD,EAgBK;AAAA;;AACV;AACAH,MAAAA,UAAU,CAAC,YAAM;AACf,QAAA,MAAI,CAAC1D,IAAL,GAAY6D,EAAZ;AACD,OAFS,EAEP,GAFO,CAAV;AAGD,KArBM;;AAsBP;;AAEAC,IAAAA,cAxBO,YAwBQN,CAxBR,EAwBW;AAChBA,MAAAA,CAAC,CAACM,cAAF;AACA,aAAO,KAAP;AACD,KA3BM;AA4BPC,IAAAA,WA5BO,YA4BKP,CA5BL,EA4BQ;AACb,UAAI,KAAKvD,OAAL,KAAiB,CAArB,EAAwB;AACtB,YAAIuD,CAAC,CAACQ,MAAF,KAAa,KAAKC,KAAL,CAAWC,SAA5B,EAAuC;AACrCV,UAAAA,CAAC,CAACM,cAAF;;AACA,cAAIhE,QAAQ,CAACqE,aAAT,KAA2B,KAAKF,KAApC,EAA2C;AACzC,iBAAKA,KAAL,CAAWC,SAAX,CAAqBE,KAArB;AACD;AACF;AACF;AACF,KArCM;AAsCPC,IAAAA,YAtCO,YAsCMb,CAtCN,EAsCS;AACdA,MAAAA,CAAC,CAACM,cAAF;;AACA,UAAI,KAAK7D,OAAL,KAAiB,CAArB,EAAwB;AACtB,YAAMqE,KAAK,GAAGd,CAAC,CAACQ,MAAF,CAASM,KAAT,IAAkBd,CAAC,CAACe,YAAF,CAAeD,KAA/C;AACA,aAAKtB,KAAL;;AACA,YAAI,KAAKwB,SAAL,CAAeF,KAAK,CAAC,CAAD,CAApB,CAAJ,EAA8B;AAC5B,eAAKG,YAAL,CAAkBH,KAAK,CAAC,CAAD,CAAvB;AACD;AACF;AACF,KA/CM;;AAgDP;AACA;AACAE,IAAAA,SAlDO,YAkDGE,IAlDH,EAkDS;AAAA,UACNjF,IADM,GACY,IADZ,CACNA,IADM;AAAA,UACAV,OADA,GACY,IADZ,CACAA,OADA,EAEd;;AACA,UAAI2F,IAAI,CAAC1G,IAAL,CAAUwB,OAAV,CAAkB,OAAlB,MAA+B,CAAC,CAApC,EAAuC;AACrC,aAAKW,QAAL,GAAgB,IAAhB;AACA,aAAKC,QAAL,GAAgBX,IAAI,CAACkF,KAAL,CAAWC,OAA3B;AACA,eAAO,KAAP;AACD,OAPa,CAQd;;;AACA,UAAIF,IAAI,CAACG,IAAL,GAAY,IAAZ,GAAmB9F,OAAvB,EAAgC;AAC9B,aAAKoB,QAAL,GAAgB,IAAhB;AACA,aAAKC,QAAL,GAAgBX,IAAI,CAACkF,KAAL,CAAWG,SAAX,GAAuB/F,OAAvB,GAAiC,IAAjD;AACA,eAAO,KAAP;AACD;;AACD,aAAO,IAAP;AACD,KAjEM;AAkEP;AACAiE,IAAAA,KAnEO,cAmEC;AACN,WAAK/C,OAAL,GAAe,CAAf;AACA,WAAKE,QAAL,GAAgB,KAAhB;AACA,WAAKC,QAAL,GAAgB,EAAhB;AACA,WAAKF,QAAL,GAAgB,CAAhB;AACD,KAxEM;AAyEP;AACAuE,IAAAA,YA1EO,YA0EMC,IA1EN,EA0EY;AAAA;;AACjB,UAAMK,EAAE,GAAG,IAAIC,UAAJ,EAAX;;AACAD,MAAAA,EAAE,CAACE,MAAH,GAAY,UAACzB,CAAD,EAAO;AACjB,QAAA,MAAI,CAACjD,YAAL,GAAoBwE,EAAE,CAACG,MAAvB;;AACA,QAAA,MAAI,CAACC,SAAL;AACD,OAHD;;AAIAJ,MAAAA,EAAE,CAACK,aAAH,CAAiBV,IAAjB;AACD,KAjFM;AAkFP;AACAS,IAAAA,SAnFO,cAmFK;AAAA;;AAAA,UAERzG,KAFQ,GASN,IATM,CAERA,KAFQ;AAAA,UAGRC,MAHQ,GASN,IATM,CAGRA,MAHQ;AAAA,UAIR0B,KAJQ,GASN,IATM,CAIRA,KAJQ;AAAA,UAKRY,KALQ,GASN,IATM,CAKRA,KALQ;AAAA,UAMRV,YANQ,GASN,IATM,CAMRA,YANQ;AAAA,UAOR0B,gBAPQ,GASN,IATM,CAORA,gBAPQ;AAAA,UAQRxC,IARQ,GASN,IATM,CAQRA,IARQ;AAUV,UAAMiD,GAAG,GAAGT,gBAAZ;AACA,UAAMoD,GAAG,GAAG,IAAIC,KAAJ,EAAZ;AACAD,MAAAA,GAAG,CAACE,GAAJ,GAAUhF,YAAV;;AACA8E,MAAAA,GAAG,CAACJ,MAAJ,GAAa,YAAM;AACjB,YAAMO,MAAM,GAAGH,GAAG,CAACzD,YAAnB;AACA,YAAM6D,OAAO,GAAGJ,GAAG,CAACxD,aAApB;AACA,YAAM6D,MAAM,GAAGF,MAAM,GAAGC,OAAxB;AACA,YAAIlD,CAAC,GAAGG,GAAG,CAAChE,KAAZ;AACA,YAAI8D,CAAC,GAAGE,GAAG,CAAC/D,MAAZ;AACA,YAAIkC,CAAC,GAAG,CAAR;AACA,YAAIC,CAAC,GAAG,CAAR,CAPiB,CAQjB;;AACA,YAAI0E,MAAM,GAAG9G,KAAT,IAAkB+G,OAAO,GAAG9G,MAAhC,EAAwC;AACtC,UAAA,MAAI,CAACwB,QAAL,GAAgB,IAAhB;AACA,UAAA,MAAI,CAACC,QAAL,GAAgBX,IAAI,CAACkF,KAAL,CAAWgB,QAAX,GAAsBjH,KAAtB,GAA8B,GAA9B,GAAoCC,MAApD;AACA,iBAAO,KAAP;AACD;;AACD,YAAI0B,KAAK,GAAGqF,MAAZ,EAAoB;AAClBlD,UAAAA,CAAC,GAAGD,CAAC,GAAGmD,MAAR;AACA5E,UAAAA,CAAC,GAAG,CAAC4B,GAAG,CAAC/D,MAAJ,GAAa6D,CAAd,IAAmB,CAAvB;AACD;;AACD,YAAInC,KAAK,GAAGqF,MAAZ,EAAoB;AAClBnD,UAAAA,CAAC,GAAGC,CAAC,GAAGkD,MAAR;AACA7E,UAAAA,CAAC,GAAG,CAAC6B,GAAG,CAAChE,KAAJ,GAAY6D,CAAb,IAAkB,CAAtB;AACD;;AACDtB,QAAAA,KAAK,CAACG,KAAN,GAAc,CAAd;AACAH,QAAAA,KAAK,CAACJ,CAAN,GAAUA,CAAV;AACAI,QAAAA,KAAK,CAACH,CAAN,GAAUA,CAAV;AACAG,QAAAA,KAAK,CAACvC,KAAN,GAAc6D,CAAd;AACAtB,QAAAA,KAAK,CAACtC,MAAN,GAAe6D,CAAf;AACAvB,QAAAA,KAAK,CAACM,MAAN,GAAe,CAAf;AACAN,QAAAA,KAAK,CAACS,QAAN,GAAiBa,CAAjB;AACAtB,QAAAA,KAAK,CAACU,SAAN,GAAkBa,CAAlB;AACAvB,QAAAA,KAAK,CAACO,QAAN,GAAiBgE,MAAM,GAAG9C,GAAG,CAACzB,KAA9B;AACAA,QAAAA,KAAK,CAACQ,SAAN,GAAkBgE,OAAO,GAAG/C,GAAG,CAACzB,KAAhC;AACAA,QAAAA,KAAK,CAACW,YAAN,GAAqB4D,MAArB;AACAvE,QAAAA,KAAK,CAACY,aAAN,GAAsB4D,OAAtB;AACA,QAAA,MAAI,CAACnF,SAAL,GAAiB+E,GAAjB;;AACA,QAAA,MAAI,CAACO,SAAL;;AACA,QAAA,MAAI,CAAChC,OAAL,CAAa,CAAb;AACD,OArCD;AAsCD,KAtIM;AAuIP;AACAiC,IAAAA,YAxIO,YAwIMrC,CAxIN,EAwIS;AACdA,MAAAA,CAAC,CAACM,cAAF,GADc,CAEd;;AACA,UAAI,KAAKjE,cAAL,IAAuB,CAAC2D,CAAC,CAACsC,aAA9B,EAA6C;AAC3C,eAAO,KAAP;AACD;;AACD,UAAMC,EAAE,GAAGvC,CAAC,CAACsC,aAAF,GAAkBtC,CAAC,CAACsC,aAAF,CAAgB,CAAhB,CAAlB,GAAuCtC,CAAlD;AANc,UAON/C,kBAPM,GAOwB,IAPxB,CAONA,kBAPM;AAAA,UAOcQ,KAPd,GAOwB,IAPxB,CAOcA,KAPd;AAQd,UAAM+E,IAAI,GAAGvF,kBAAb;AACAuF,MAAAA,IAAI,CAACrF,EAAL,GAAUoF,EAAE,CAACE,OAAb;AACAD,MAAAA,IAAI,CAACpF,EAAL,GAAUmF,EAAE,CAACG,OAAb;AACAF,MAAAA,IAAI,CAACnF,CAAL,GAASI,KAAK,CAACJ,CAAf;AACAmF,MAAAA,IAAI,CAAClF,CAAL,GAASG,KAAK,CAACH,CAAf;AACAkF,MAAAA,IAAI,CAACtF,EAAL,GAAU,IAAV;AACD,KAtJM;AAuJP;AACAyF,IAAAA,OAxJO,YAwJC3C,CAxJD,EAwJI;AACTA,MAAAA,CAAC,CAACM,cAAF,GADS,CAET;;AACA,UAAI,KAAKjE,cAAL,IAAuB,CAAC2D,CAAC,CAACsC,aAA9B,EAA6C;AAC3C,eAAO,KAAP;AACD;;AACD,UAAMC,EAAE,GAAGvC,CAAC,CAACsC,aAAF,GAAkBtC,CAAC,CAACsC,aAAF,CAAgB,CAAhB,CAAlB,GAAuCtC,CAAlD;AANS,kCAWL,IAXK,CAQP/C,kBARO;AAAA,UAQeC,EARf,yBAQeA,EARf;AAAA,UAQmBC,EARnB,yBAQmBA,EARnB;AAAA,UAQuBC,EARvB,yBAQuBA,EARvB;AAAA,UAQ2BC,CAR3B,yBAQ2BA,CAR3B;AAAA,UAQ8BC,CAR9B,yBAQ8BA,CAR9B;AAAA,UASPG,KATO,GAWL,IAXK,CASPA,KATO;AAAA,UAUPgB,gBAVO,GAWL,IAXK,CAUPA,gBAVO;AAYT,UAAMS,GAAG,GAAGT,gBAAZ;AACA,UAAMmE,EAAE,GAAGL,EAAE,CAACE,OAAd;AACA,UAAMI,EAAE,GAAGN,EAAE,CAACG,OAAd;AACA,UAAMI,EAAE,GAAGF,EAAE,GAAGzF,EAAhB;AACA,UAAM4F,EAAE,GAAGF,EAAE,GAAGzF,EAAhB;AACA,UAAI4F,EAAE,GAAG3F,CAAC,GAAGyF,EAAb;AACA,UAAIG,EAAE,GAAG3F,CAAC,GAAGyF,EAAb;AACA,UAAI,CAAC7F,EAAL,EAAS;;AACT,UAAI8F,EAAE,GAAG,CAAT,EAAY;AACVA,QAAAA,EAAE,GAAG,CAAL;AACD;;AACD,UAAIC,EAAE,GAAG,CAAT,EAAY;AACVA,QAAAA,EAAE,GAAG,CAAL;AACD;;AACD,UAAID,EAAE,GAAG9D,GAAG,CAAChE,KAAJ,GAAYuC,KAAK,CAACvC,KAA3B,EAAkC;AAChC8H,QAAAA,EAAE,GAAG9D,GAAG,CAAChE,KAAJ,GAAYuC,KAAK,CAACvC,KAAvB;AACD;;AACD,UAAI+H,EAAE,GAAG/D,GAAG,CAAC/D,MAAJ,GAAasC,KAAK,CAACtC,MAA5B,EAAoC;AAClC8H,QAAAA,EAAE,GAAG/D,GAAG,CAAC/D,MAAJ,GAAasC,KAAK,CAACtC,MAAxB;AACD;;AACDsC,MAAAA,KAAK,CAACJ,CAAN,GAAU2F,EAAV;AACAvF,MAAAA,KAAK,CAACH,CAAN,GAAU2F,EAAV;AACD,KA1LM;AA2LP;AACAC,IAAAA,gBA5LO,YA4LUlD,CA5LV,EA4La;AAAA;;AAAA,UACVvC,KADU,GACA,IADA,CACVA,KADU;AAElBA,MAAAA,KAAK,CAACK,WAAN,GAAoB,IAApB;;AACA,UAAMqF,MAAM,GAAG,YAAM;AACnB,YAAI1F,KAAK,CAACK,WAAV,EAAuB;AACrB,cAAMC,MAAM,GAAG,EAAEN,KAAK,CAACM,MAAvB;;AACA,UAAA,MAAI,CAACqE,SAAL,CAAerE,MAAf;;AACAmC,UAAAA,UAAU,CAAC,YAAY;AACrBiD,YAAAA,MAAM;AACP,WAFS,EAEP,EAFO,CAAV;AAGD;AACF,OARD;;AASAA,MAAAA,MAAM;AACP,KAzMM;AA0MP;AACAC,IAAAA,eA3MO,YA2MSpD,CA3MT,EA2MY;AAAA;;AAAA,UACTvC,KADS,GACC,IADD,CACTA,KADS;AAEjBA,MAAAA,KAAK,CAACI,UAAN,GAAmB,IAAnB;;AACA,UAAMsF,MAAM,GAAG,YAAM;AACnB,YAAI1F,KAAK,CAACI,UAAV,EAAsB;AACpB,cAAME,MAAM,GAAG,EAAEN,KAAK,CAACM,MAAvB;;AACA,UAAA,MAAI,CAACqE,SAAL,CAAerE,MAAf;;AACAmC,UAAAA,UAAU,CAAC,YAAY;AACrBiD,YAAAA,MAAM;AACP,WAFS,EAEP,EAFO,CAAV;AAGD;AACF,OARD;;AASAA,MAAAA,MAAM;AACP,KAxNM;AAyNP;AACAE,IAAAA,SA1NO,cA0NK;AAAA,UACF5F,KADE,GACQ,IADR,CACFA,KADE;AAEVA,MAAAA,KAAK,CAACI,UAAN,GAAmB,KAAnB;AACAJ,MAAAA,KAAK,CAACK,WAAN,GAAoB,KAApB;AACD,KA9NM;AA+NP;AACAwF,IAAAA,YAhOO,YAgOMtD,CAhON,EAgOS;AAAA;;AAAA,UACNvC,KADM,GACI,IADJ,CACNA,KADM;AAEdA,MAAAA,KAAK,CAACC,SAAN,GAAkB,IAAlB;;AACA,UAAM6F,IAAI,GAAG,YAAM;AACjB,YAAI9F,KAAK,CAACC,SAAV,EAAqB;AACnB,cAAME,KAAK,GAAGH,KAAK,CAACG,KAAN,IAAe,GAAf,GAAqB,GAArB,GAA2B,EAAEH,KAAK,CAACG,KAAjD;;AACA,UAAA,MAAI,CAAC4F,OAAL,CAAa5F,KAAb;;AACAsC,UAAAA,UAAU,CAAC,YAAY;AACrBqD,YAAAA,IAAI;AACL,WAFS,EAEP,EAFO,CAAV;AAGD;AACF,OARD;;AASAA,MAAAA,IAAI;AACL,KA7OM;AA8OP;AACAE,IAAAA,UA/OO,YA+OIzD,CA/OJ,EA+OO;AACZ,WAAKvC,KAAL,CAAWC,SAAX,GAAuB,KAAvB;AACD,KAjPM;AAkPP;AACAgG,IAAAA,YAnPO,YAmPM1D,CAnPN,EAmPS;AAAA;;AAAA,UACNvC,KADM,GACI,IADJ,CACNA,KADM;AAEdA,MAAAA,KAAK,CAACE,SAAN,GAAkB,IAAlB;;AACA,UAAM4F,IAAI,GAAG,YAAM;AACjB,YAAI9F,KAAK,CAACE,SAAV,EAAqB;AACnB,cAAMC,KAAK,GAAGH,KAAK,CAACG,KAAN,IAAe,CAAf,GAAmB,CAAnB,GAAuB,EAAEH,KAAK,CAACG,KAA7C;;AACA,UAAA,MAAI,CAAC4F,OAAL,CAAa5F,KAAb;;AACAsC,UAAAA,UAAU,CAAC,YAAY;AACrBqD,YAAAA,IAAI;AACL,WAFS,EAEP,EAFO,CAAV;AAGD;AACF,OARD;;AASAA,MAAAA,IAAI;AACL,KAhQM;AAiQP;AACAI,IAAAA,UAlQO,YAkQI3D,CAlQJ,EAkQO;AAAA,UACJvC,KADI,GACM,IADN,CACJA,KADI;AAEZA,MAAAA,KAAK,CAACE,SAAN,GAAkB,KAAlB;AACD,KArQM;AAsQPiG,IAAAA,UAtQO,YAsQI5D,CAtQJ,EAsQO;AACZ,WAAKwD,OAAL,CAAaxD,CAAC,CAACQ,MAAF,CAAS5F,KAAtB;AACD,KAxQM;AAyQP;AACA4I,IAAAA,OA1QO,YA0QCK,QA1QD,EA0QW;AAAA;;AAAA,UACRpF,gBADQ,GACoB,IADpB,CACRA,gBADQ;AAAA,UACUhB,KADV,GACoB,IADpB,CACUA,KADV;AAAA,UAERO,QAFQ,GAGdP,KAHc,CAERO,QAFQ;AAAA,UAEEC,SAFF,GAGdR,KAHc,CAEEQ,SAFF;AAAA,UAEaC,QAFb,GAGdT,KAHc,CAEaS,QAFb;AAAA,UAEuBC,SAFvB,GAGdV,KAHc,CAEuBU,SAFvB;AAAA,UAEkCjD,KAFlC,GAGduC,KAHc,CAEkCvC,KAFlC;AAAA,UAEyCC,MAFzC,GAGdsC,KAHc,CAEyCtC,MAFzC;AAAA,UAEiDkC,CAFjD,GAGdI,KAHc,CAEiDJ,CAFjD;AAAA,UAEoDC,CAFpD,GAGdG,KAHc,CAEoDH,CAFpD;AAIhB,UAAM4B,GAAG,GAAGT,gBAAZ,CAJgB,CAKhB;;AACA,UAAMqF,MAAM,GAAG5E,GAAG,CAAChE,KAAnB;AACA,UAAM6I,OAAO,GAAG7E,GAAG,CAAC/D,MAApB,CAPgB,CAQhB;;AACA,UAAM6G,MAAM,GAAG9D,QAAQ,GAAI,CAACF,QAAQ,GAAGE,QAAZ,IAAwB2F,QAAzB,GAAqC,GAA/D;AACA,UAAM5B,OAAO,GAAG9D,SAAS,GAAI,CAACF,SAAS,GAAGE,SAAb,IAA0B0F,QAA3B,GAAuC,GAAnE,CAVgB,CAWhB;;AACA,UAAIjB,EAAE,GAAGkB,MAAM,GAAG,CAAT,GAAc9B,MAAM,GAAG9G,KAAV,IAAoB4I,MAAM,GAAG,CAAT,GAAazG,CAAjC,CAAtB;AACA,UAAIwF,EAAE,GAAGkB,OAAO,GAAG,CAAV,GAAe9B,OAAO,GAAG9G,MAAX,IAAsB4I,OAAO,GAAG,CAAV,GAAczG,CAApC,CAAvB,CAbgB,CAchB;;AACA,UAAIsF,EAAE,GAAG,CAAT,EAAY;AACVA,QAAAA,EAAE,GAAG,CAAL;AACD;;AACD,UAAIC,EAAE,GAAG,CAAT,EAAY;AACVA,QAAAA,EAAE,GAAG,CAAL;AACD;;AACD,UAAID,EAAE,GAAGkB,MAAM,GAAG9B,MAAlB,EAA0B;AACxBY,QAAAA,EAAE,GAAGkB,MAAM,GAAG9B,MAAd;AACD;;AACD,UAAIa,EAAE,GAAGkB,OAAO,GAAG9B,OAAnB,EAA4B;AAC1BY,QAAAA,EAAE,GAAGkB,OAAO,GAAG9B,OAAf;AACD,OA1Be,CA2BhB;;;AACAxE,MAAAA,KAAK,CAACJ,CAAN,GAAUuF,EAAV;AACAnF,MAAAA,KAAK,CAACH,CAAN,GAAUuF,EAAV;AACApF,MAAAA,KAAK,CAACvC,KAAN,GAAc8G,MAAd;AACAvE,MAAAA,KAAK,CAACtC,MAAN,GAAe8G,OAAf;AACAxE,MAAAA,KAAK,CAACG,KAAN,GAAciG,QAAd;AACA3D,MAAAA,UAAU,CAAC,YAAM;AACf,YAAIzC,KAAK,CAACG,KAAN,KAAgBiG,QAApB,EAA8B;AAC5B,UAAA,MAAI,CAACzB,SAAL;AACD;AACF,OAJS,EAIP,GAJO,CAAV;AAKD,KAhTM;AAiTP;AACAA,IAAAA,SAlTO,YAkTGpC,CAlTH,EAkTM;AAAA,UAET9D,IAFS,GAMP,IANO,CAETA,IAFS;AAAA,UAGTY,SAHS,GAMP,IANO,CAGTA,SAHS;AAAA,wBAMP,IANO,CAITW,KAJS;AAAA,UAIAJ,CAJA,eAIAA,CAJA;AAAA,UAIGC,CAJH,eAIGA,CAJH;AAAA,UAIMpC,KAJN,eAIMA,KAJN;AAAA,UAIaC,MAJb,eAIaA,MAJb;AAAA,UAIqB4C,MAJrB,eAIqBA,MAJrB;AAAA,UAKWN,KALX,GAMP,IANO,CAKTgB,gBALS,CAKWhB,KALX;AAOX,UAAMuG,MAAM,GAAG,KAAKvD,KAAL,CAAWuD,MAA1B;AACA,UAAMC,GAAG,GAAGD,MAAM,CAACE,UAAP,CAAkB,IAAlB,CAAZ;;AACA,UAAIlE,CAAJ,EAAO;AACL;AACA,aAAK/C,kBAAL,CAAwBC,EAAxB,GAA6B,KAA7B;AACD;;AACD8G,MAAAA,MAAM,CAAC9I,KAAP,GAAe,KAAKA,KAApB;AACA8I,MAAAA,MAAM,CAAC7I,MAAP,GAAgB,KAAKA,MAArB;AACA8I,MAAAA,GAAG,CAACE,SAAJ,CAAc,CAAd,EAAiB,CAAjB,EAAoB,KAAKjJ,KAAzB,EAAgC,KAAKC,MAArC,EAfW,CAgBX;;AACA8I,MAAAA,GAAG,CAACG,SAAJ,GAAgB,MAAhB;AACAH,MAAAA,GAAG,CAACI,QAAJ,CAAa,CAAb,EAAgB,CAAhB,EAAmB,KAAKnJ,KAAxB,EAA+B,KAAKC,MAApC;AACA8I,MAAAA,GAAG,CAACK,SAAJ,CAAc,KAAKpJ,KAAL,GAAa,GAA3B,EAAgC,KAAKC,MAAL,GAAc,GAA9C;AACA8I,MAAAA,GAAG,CAACd,MAAJ,CAAYoB,IAAI,CAACC,EAAL,GAAUzG,MAAX,GAAqB,GAAhC;AACAkG,MAAAA,GAAG,CAACK,SAAJ,CAAc,CAAC,KAAKpJ,KAAN,GAAc,GAA5B,EAAiC,CAAC,KAAKC,MAAN,GAAe,GAAhD;AACA8I,MAAAA,GAAG,CAACQ,SAAJ,CACE3H,SADF,EAEEO,CAAC,GAAGI,KAFN,EAGEH,CAAC,GAAGG,KAHN,EAIEvC,KAAK,GAAGuC,KAJV,EAKEtC,MAAM,GAAGsC,KALX;AAOA,WAAKT,YAAL,GAAoBgH,MAAM,CAACU,SAAP,CAAiBxI,IAAjB,CAApB;AACD,KAhVM;AAiVPyI,IAAAA,aAjVO,cAiVS;AAAA,UACN7J,GADM,GAC2B,IAD3B,CACNA,GADM;AAAA,UACDkC,YADC,GAC2B,IAD3B,CACDA,YADC;AAAA,UACazC,KADb,GAC2B,IAD3B,CACaA,KADb;AAAA,UACoBG,EADpB,GAC2B,IAD3B,CACoBA,EADpB;AAEd,WAAKyF,KAAL,CAAW,cAAX,EAA2BnD,YAA3B,EAAyCzC,KAAzC,EAAgDG,EAAhD;;AACA,UAAI,OAAOI,GAAP,KAAe,QAAf,IAA2BA,GAA/B,EAAoC;AAClC,aAAK8J,MAAL;AACD,OAFD,MAEO;AACL,aAAK3E,GAAL;AACD;AACF,KAzVM;AA0VP;AACA2E,IAAAA,MA3VO,cA2VE;AAAA,UACC3I,IADD,GAEL,IAFK,CACCA,IADD;AAAA,UACOP,SADP,GAEL,IAFK,CACOA,SADP;AAAA,UACkBQ,IADlB,GAEL,IAFK,CACkBA,IADlB;AAAA,UACwBpB,GADxB,GAEL,IAFK,CACwBA,GADxB;AAAA,UAC6BC,MAD7B,GAEL,IAFK,CAC6BA,MAD7B;AAAA,UACqCR,KADrC,GAEL,IAFK,CACqCA,KADrC;AAAA,UAC4CG,EAD5C,GAEL,IAFK,CAC4CA,EAD5C;AAAA,UACgDsC,YADhD,GAEL,IAFK,CACgDA,YADhD;AAGP,UAAM6H,MAAM,GAAG,IAAIzI,QAAJ,EAAf,CAHO,CAIP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,WAAKoD,KAAL;AACA,WAAK/C,OAAL,GAAe,CAAf;AACA,WAAK2D,OAAL,CAAa,CAAb;AACA,WAAK3D,OAAL,GAAe,CAAf,CAzBO,CA0BP;;AACA,WAAK0D,KAAL,CAAW,qBAAX,EAAkC;AAChCW,QAAAA,KAAK,EAAE;AACLgE,UAAAA,MAAM,EAAE9H;AADH;AADyB,OAAlC,EA3BO,CAgCP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACD,KA9ZM;AA+ZP2C,IAAAA,YA/ZO,YA+ZMK,CA/ZN,EA+ZS;AACd,UAAI,KAAKpF,KAAL,KAAeoF,CAAC,CAAC+E,GAAF,KAAU,QAAV,IAAsB/E,CAAC,CAACgF,OAAF,KAAc,EAAnD,CAAJ,EAA4D;AAC1D,aAAK/E,GAAL;AACD;AACF;AAnaM;AAtQI,CARf","sourcesContent":["\n\"use strict\";\n// import request from '@/utils/request'\nimport language from \"./utils/language.js\";\nimport mimes from \"./utils/mimes.js\";\nimport data2blob from \"./utils/data2blob.js\";\nimport effectRipple from \"./utils/effectRipple.js\";\nimport Images from \"../../../features/images/app/collections\";\nexport default {\n  props: {\n    // 域，上传文件name，触发事件会带上（如果一个页面多个图片上传控件，可以做区分\n    field: {\n      type: String,\n      default: \"avatar\",\n    },\n    // 原名key，类似于id，触发事件会带上（如果一个页面多个图片上传控件，可以做区分\n    ki: {\n      type: Number,\n      default: 0,\n    },\n    // 显示该控件与否\n    value: {\n      type: Boolean,\n      default: true,\n    },\n    // 上传地址\n    url: {\n      type: String,\n      default: \"\",\n    },\n    // 其他要上传文件附带的数据，对象格式\n    params: {\n      type: Object,\n      default: null,\n    },\n    // Add custom headers\n    headers: {\n      type: Object,\n      default: null,\n    },\n    // 剪裁图片的宽\n    width: {\n      type: Number,\n      default: 200,\n    },\n    // 剪裁图片的高\n    height: {\n      type: Number,\n      default: 200,\n    },\n    // 不显示旋转功能\n    noRotate: {\n      type: Boolean,\n      default: true,\n    },\n    // 不预览圆形图片\n    noCircle: {\n      type: Boolean,\n      default: false,\n    },\n    // 不预览方形图片\n    noSquare: {\n      type: Boolean,\n      default: false,\n    },\n    // 单文件大小限制\n    maxSize: {\n      type: Number,\n      default: 10240,\n    },\n    // 语言类型\n    langType: {\n      type: String,\n      default: \"zh\",\n    },\n    // 语言包\n    langExt: {\n      type: Object,\n      default: null,\n    },\n    // 图片上传格式\n    imgFormat: {\n      type: String,\n      default: \"png\",\n    },\n    // 是否支持跨域\n    withCredentials: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  data() {\n    const { imgFormat, langType, langExt, width, height } = this;\n    let isSupported = true;\n    const allowImgFormat = [\"jpg\", \"png\"];\n    const tempImgFormat =\n      allowImgFormat.indexOf(imgFormat) === -1 ? \"jpg\" : imgFormat;\n    const lang = language[langType] ? language[langType] : language[\"en\"];\n    const mime = mimes[tempImgFormat];\n    // 规范图片格式\n    this.imgFormat = tempImgFormat;\n    if (langExt) {\n      Object.assign(lang, langExt);\n    }\n    if (typeof FormData !== \"function\") {\n      isSupported = false;\n    }\n    return {\n      // 图片的mime\n      mime,\n      // 语言包\n      lang,\n      // 浏览器是否支持该控件\n      isSupported,\n      // 浏览器是否支持触屏事件\n      // eslint-disable-next-line no-prototype-builtins\n      isSupportTouch: document.hasOwnProperty(\"ontouchstart\"),\n      // 步骤\n      step: 1, // 1选择文件 2剪裁 3上传\n      // 上传状态及进度\n      loading: 0, // 0未开始 1正在 2成功 3错误\n      progress: 0,\n      // 是否有错误及错误信息\n      hasError: false,\n      errorMsg: \"\",\n      // 需求图宽高比\n      ratio: width / height,\n      // 原图地址、生成图片地址\n      sourceImg: null,\n      sourceImgUrl: \"\",\n      createImgUrl: \"\",\n      // 原图片拖动事件初始值\n      sourceImgMouseDown: {\n        on: false,\n        mX: 0, // 鼠标按下的坐标\n        mY: 0,\n        x: 0, // scale原图坐标\n        y: 0,\n      },\n      // 生成图片预览的容器大小\n      previewContainer: {\n        width: 100,\n        height: 100,\n      },\n      // 原图容器宽高\n      sourceImgContainer: {\n        // sic\n        width: 240,\n        height: 184, // 如果生成图比例与此一致会出现bug，先改成特殊的格式吧，哈哈哈\n      },\n      // 原图展示属性\n      scale: {\n        zoomAddOn: false, // 按钮缩放事件开启\n        zoomSubOn: false, // 按钮缩放事件开启\n        range: 1, // 最大100\n        rotateLeft: false, // 按钮向左旋转事件开启\n        rotateRight: false, // 按钮向右旋转事件开启\n        degree: 0, // 旋转度数\n        x: 0,\n        y: 0,\n        width: 0,\n        height: 0,\n        maxWidth: 0,\n        maxHeight: 0,\n        minWidth: 0, // 最宽\n        minHeight: 0,\n        naturalWidth: 0, // 原宽\n        naturalHeight: 0,\n      },\n    };\n  },\n  computed: {\n    // 进度条样式\n    progressStyle() {\n      const { progress } = this;\n      return {\n        width: progress + \"%\",\n      };\n    },\n    // 原图样式\n    sourceImgStyle() {\n      const { scale, sourceImgMasking } = this;\n      const top = scale.y + sourceImgMasking.y + \"px\";\n      const left = scale.x + sourceImgMasking.x + \"px\";\n      return {\n        top,\n        left,\n        width: scale.width + \"px\",\n        height: scale.height + \"px\",\n        transform: \"rotate(\" + scale.degree + \"deg)\", // 旋转时 左侧原始图旋转样式\n        \"-ms-transform\": \"rotate(\" + scale.degree + \"deg)\", // 兼容IE9\n        \"-moz-transform\": \"rotate(\" + scale.degree + \"deg)\", // 兼容FireFox\n        \"-webkit-transform\": \"rotate(\" + scale.degree + \"deg)\", // 兼容Safari 和 chrome\n        \"-o-transform\": \"rotate(\" + scale.degree + \"deg)\", // 兼容 Opera\n      };\n    },\n    // 原图蒙版属性\n    sourceImgMasking() {\n      const { width, height, ratio, sourceImgContainer } = this;\n      const sic = sourceImgContainer;\n      const sicRatio = sic.width / sic.height; // 原图容器宽高比\n      let x = 0;\n      let y = 0;\n      let w = sic.width;\n      let h = sic.height;\n      let scale = 1;\n      if (ratio < sicRatio) {\n        scale = sic.height / height;\n        w = sic.height * ratio;\n        x = (sic.width - w) / 2;\n      }\n      if (ratio > sicRatio) {\n        scale = sic.width / width;\n        h = sic.width / ratio;\n        y = (sic.height - h) / 2;\n      }\n      return {\n        scale, // 蒙版相对需求宽高的缩放\n        x,\n        y,\n        width: w,\n        height: h,\n      };\n    },\n    // 原图遮罩样式\n    sourceImgShadeStyle() {\n      const { sourceImgMasking, sourceImgContainer } = this;\n      const sic = sourceImgContainer;\n      const sim = sourceImgMasking;\n      const w =\n        sim.width === sic.width ? sim.width : (sic.width - sim.width) / 2;\n      const h =\n        sim.height === sic.height ? sim.height : (sic.height - sim.height) / 2;\n      return {\n        width: w + \"px\",\n        height: h + \"px\",\n      };\n    },\n    previewStyle() {\n      const { ratio, previewContainer } = this;\n      const pc = previewContainer;\n      let w = pc.width;\n      let h = pc.height;\n      const pcRatio = w / h;\n      if (ratio < pcRatio) {\n        w = pc.height * ratio;\n      }\n      if (ratio > pcRatio) {\n        h = pc.width / ratio;\n      }\n      return {\n        width: w + \"px\",\n        height: h + \"px\",\n      };\n    },\n  },\n  watch: {\n    value(newValue) {\n      if (newValue && this.loading !== 1) {\n        this.reset();\n      }\n    },\n  },\n  created() {\n    // 绑定按键esc隐藏此插件事件\n    document.addEventListener(\"keyup\", this.closeHandler);\n  },\n  destroyed() {\n    document.removeEventListener(\"keyup\", this.closeHandler);\n  },\n  methods: {\n    // 点击波纹效果\n    ripple(e) {\n      effectRipple(e);\n    },\n    // 关闭控件\n    off() {\n      setTimeout(() => {\n        this.$emit(\"input\", false);\n        this.$emit(\"close\");\n        if (this.step === 3 && this.loading === 2) {\n          this.setStep(1);\n        }\n      }, 200);\n    },\n    // 设置步骤\n    setStep(no) {\n      // 延时是为了显示动画效果呢，哈哈哈\n      setTimeout(() => {\n        this.step = no;\n      }, 200);\n    },\n    /* 图片选择区域函数绑定\n     ---------------------------------------------------------------*/\n    preventDefault(e) {\n      e.preventDefault();\n      return false;\n    },\n    handleClick(e) {\n      if (this.loading !== 1) {\n        if (e.target !== this.$refs.fileinput) {\n          e.preventDefault();\n          if (document.activeElement !== this.$refs) {\n            this.$refs.fileinput.click();\n          }\n        }\n      }\n    },\n    handleChange(e) {\n      e.preventDefault();\n      if (this.loading !== 1) {\n        const files = e.target.files || e.dataTransfer.files;\n        this.reset();\n        if (this.checkFile(files[0])) {\n          this.setSourceImg(files[0]);\n        }\n      }\n    },\n    /* ---------------------------------------------------------------*/\n    // 检测选择的文件是否合适\n    checkFile(file) {\n      const { lang, maxSize } = this;\n      // 仅限图片\n      if (file.type.indexOf(\"image\") === -1) {\n        this.hasError = true;\n        this.errorMsg = lang.error.onlyImg;\n        return false;\n      }\n      // 超出大小\n      if (file.size / 1024 > maxSize) {\n        this.hasError = true;\n        this.errorMsg = lang.error.outOfSize + maxSize + \"kb\";\n        return false;\n      }\n      return true;\n    },\n    // 重置控件\n    reset() {\n      this.loading = 0;\n      this.hasError = false;\n      this.errorMsg = \"\";\n      this.progress = 0;\n    },\n    // 设置图片源\n    setSourceImg(file) {\n      const fr = new FileReader();\n      fr.onload = (e) => {\n        this.sourceImgUrl = fr.result;\n        this.startCrop();\n      };\n      fr.readAsDataURL(file);\n    },\n    // 剪裁前准备工作\n    startCrop() {\n      const {\n        width,\n        height,\n        ratio,\n        scale,\n        sourceImgUrl,\n        sourceImgMasking,\n        lang,\n      } = this;\n      const sim = sourceImgMasking;\n      const img = new Image();\n      img.src = sourceImgUrl;\n      img.onload = () => {\n        const nWidth = img.naturalWidth;\n        const nHeight = img.naturalHeight;\n        const nRatio = nWidth / nHeight;\n        let w = sim.width;\n        let h = sim.height;\n        let x = 0;\n        let y = 0;\n        // 图片像素不达标\n        if (nWidth < width || nHeight < height) {\n          this.hasError = true;\n          this.errorMsg = lang.error.lowestPx + width + \"*\" + height;\n          return false;\n        }\n        if (ratio > nRatio) {\n          h = w / nRatio;\n          y = (sim.height - h) / 2;\n        }\n        if (ratio < nRatio) {\n          w = h * nRatio;\n          x = (sim.width - w) / 2;\n        }\n        scale.range = 0;\n        scale.x = x;\n        scale.y = y;\n        scale.width = w;\n        scale.height = h;\n        scale.degree = 0;\n        scale.minWidth = w;\n        scale.minHeight = h;\n        scale.maxWidth = nWidth * sim.scale;\n        scale.maxHeight = nHeight * sim.scale;\n        scale.naturalWidth = nWidth;\n        scale.naturalHeight = nHeight;\n        this.sourceImg = img;\n        this.createImg();\n        this.setStep(2);\n      };\n    },\n    // 鼠标按下图片准备移动\n    imgStartMove(e) {\n      e.preventDefault();\n      // 支持触摸事件，则鼠标事件无效\n      if (this.isSupportTouch && !e.targetTouches) {\n        return false;\n      }\n      const et = e.targetTouches ? e.targetTouches[0] : e;\n      const { sourceImgMouseDown, scale } = this;\n      const simd = sourceImgMouseDown;\n      simd.mX = et.screenX;\n      simd.mY = et.screenY;\n      simd.x = scale.x;\n      simd.y = scale.y;\n      simd.on = true;\n    },\n    // 鼠标按下状态下移动，图片移动\n    imgMove(e) {\n      e.preventDefault();\n      // 支持触摸事件，则鼠标事件无效\n      if (this.isSupportTouch && !e.targetTouches) {\n        return false;\n      }\n      const et = e.targetTouches ? e.targetTouches[0] : e;\n      const {\n        sourceImgMouseDown: { on, mX, mY, x, y },\n        scale,\n        sourceImgMasking,\n      } = this;\n      const sim = sourceImgMasking;\n      const nX = et.screenX;\n      const nY = et.screenY;\n      const dX = nX - mX;\n      const dY = nY - mY;\n      let rX = x + dX;\n      let rY = y + dY;\n      if (!on) return;\n      if (rX > 0) {\n        rX = 0;\n      }\n      if (rY > 0) {\n        rY = 0;\n      }\n      if (rX < sim.width - scale.width) {\n        rX = sim.width - scale.width;\n      }\n      if (rY < sim.height - scale.height) {\n        rY = sim.height - scale.height;\n      }\n      scale.x = rX;\n      scale.y = rY;\n    },\n    // 按钮按下开始向右旋转\n    startRotateRight(e) {\n      const { scale } = this;\n      scale.rotateRight = true;\n      const rotate = () => {\n        if (scale.rotateRight) {\n          const degree = ++scale.degree;\n          this.createImg(degree);\n          setTimeout(function () {\n            rotate();\n          }, 60);\n        }\n      };\n      rotate();\n    },\n    // 按钮按下开始向左旋转\n    startRotateLeft(e) {\n      const { scale } = this;\n      scale.rotateLeft = true;\n      const rotate = () => {\n        if (scale.rotateLeft) {\n          const degree = --scale.degree;\n          this.createImg(degree);\n          setTimeout(function () {\n            rotate();\n          }, 60);\n        }\n      };\n      rotate();\n    },\n    // 停止旋转\n    endRotate() {\n      const { scale } = this;\n      scale.rotateLeft = false;\n      scale.rotateRight = false;\n    },\n    // 按钮按下开始放大\n    startZoomAdd(e) {\n      const { scale } = this;\n      scale.zoomAddOn = true;\n      const zoom = () => {\n        if (scale.zoomAddOn) {\n          const range = scale.range >= 100 ? 100 : ++scale.range;\n          this.zoomImg(range);\n          setTimeout(function () {\n            zoom();\n          }, 60);\n        }\n      };\n      zoom();\n    },\n    // 按钮松开或移开取消放大\n    endZoomAdd(e) {\n      this.scale.zoomAddOn = false;\n    },\n    // 按钮按下开始缩小\n    startZoomSub(e) {\n      const { scale } = this;\n      scale.zoomSubOn = true;\n      const zoom = () => {\n        if (scale.zoomSubOn) {\n          const range = scale.range <= 0 ? 0 : --scale.range;\n          this.zoomImg(range);\n          setTimeout(function () {\n            zoom();\n          }, 60);\n        }\n      };\n      zoom();\n    },\n    // 按钮松开或移开取消缩小\n    endZoomSub(e) {\n      const { scale } = this;\n      scale.zoomSubOn = false;\n    },\n    zoomChange(e) {\n      this.zoomImg(e.target.value);\n    },\n    // 缩放原图\n    zoomImg(newRange) {\n      const { sourceImgMasking, scale } = this;\n      const { maxWidth, maxHeight, minWidth, minHeight, width, height, x, y } =\n        scale;\n      const sim = sourceImgMasking;\n      // 蒙版宽高\n      const sWidth = sim.width;\n      const sHeight = sim.height;\n      // 新宽高\n      const nWidth = minWidth + ((maxWidth - minWidth) * newRange) / 100;\n      const nHeight = minHeight + ((maxHeight - minHeight) * newRange) / 100;\n      // 新坐标（根据蒙版中心点缩放）\n      let nX = sWidth / 2 - (nWidth / width) * (sWidth / 2 - x);\n      let nY = sHeight / 2 - (nHeight / height) * (sHeight / 2 - y);\n      // 判断新坐标是否超过蒙版限制\n      if (nX > 0) {\n        nX = 0;\n      }\n      if (nY > 0) {\n        nY = 0;\n      }\n      if (nX < sWidth - nWidth) {\n        nX = sWidth - nWidth;\n      }\n      if (nY < sHeight - nHeight) {\n        nY = sHeight - nHeight;\n      }\n      // 赋值处理\n      scale.x = nX;\n      scale.y = nY;\n      scale.width = nWidth;\n      scale.height = nHeight;\n      scale.range = newRange;\n      setTimeout(() => {\n        if (scale.range === newRange) {\n          this.createImg();\n        }\n      }, 300);\n    },\n    // 生成需求图片\n    createImg(e) {\n      const {\n        mime,\n        sourceImg,\n        scale: { x, y, width, height, degree },\n        sourceImgMasking: { scale },\n      } = this;\n      const canvas = this.$refs.canvas;\n      const ctx = canvas.getContext(\"2d\");\n      if (e) {\n        // 取消鼠标按下移动状态\n        this.sourceImgMouseDown.on = false;\n      }\n      canvas.width = this.width;\n      canvas.height = this.height;\n      ctx.clearRect(0, 0, this.width, this.height);\n      // 将透明区域设置为白色底边\n      ctx.fillStyle = \"#fff\";\n      ctx.fillRect(0, 0, this.width, this.height);\n      ctx.translate(this.width * 0.5, this.height * 0.5);\n      ctx.rotate((Math.PI * degree) / 180);\n      ctx.translate(-this.width * 0.5, -this.height * 0.5);\n      ctx.drawImage(\n        sourceImg,\n        x / scale,\n        y / scale,\n        width / scale,\n        height / scale\n      );\n      this.createImgUrl = canvas.toDataURL(mime);\n    },\n    prepareUpload() {\n      const { url, createImgUrl, field, ki } = this;\n      this.$emit(\"crop-success\", createImgUrl, field, ki);\n      if (typeof url === \"string\" && url) {\n        this.upload();\n      } else {\n        this.off();\n      }\n    },\n    // 上传图片\n    upload() {\n      const { lang, imgFormat, mime, url, params, field, ki, createImgUrl } =\n        this;\n      const fmData = new FormData();\n      // fmData.append(\n      //   field,\n      //   data2blob(createImgUrl, mime),\n      //   field + \".\" + imgFormat\n      // );\n      // // 添加其他参数\n      // if (typeof params === \"object\" && params) {\n      //   Object.keys(params).forEach((k) => {\n      //     fmData.append(k, params[k]);\n      //   });\n      // }\n      // 监听进度回调\n      // const uploadProgress = (event) => {\n      //   if (event.lengthComputable) {\n      //     this.progress = (100 * Math.round(event.loaded)) / event.total;\n      //   }\n      // };\n      // 上传文件\n      this.reset();\n      this.loading = 1;\n      this.setStep(3);\n      this.loading = 2;\n      // debugger;\n      this.$emit(\"crop-upload-success\", {\n        files: {\n          avatar: createImgUrl,\n        },\n      });\n      // debugger;\n      // let uploadInstance = Images.insert(\n      //   {\n      //     file: createImgUrl,\n      //     isBase64: true,\n      //     fileName: field + \".\" + imgFormat,\n      //     // meta: {\n      //     //   userId: Meteor.userId(),\n      //     // },\n      //     chunkSize: \"dynamic\",\n      //     allowWebWorkers: true,\n      //   },\n      //   false\n      // );\n      // uploadInstance.on(\"uploaded\", (error, fileObj) => {\n      //   if (error) {\n      //     return;\n      //   }\n      //   this.loading = 2;\n      //   // debugger;\n      //   this.$emit(\"crop-upload-success\", {\n      //     files:{\n      //       avatar: createImgUrl\n      //     }\n      //   });\n      // });\n      // uploadInstance.on(\"error\", (err) => {\n      //   if (this.value) {\n      //     this.loading = 3;\n      //     this.hasError = true;\n      //     this.errorMsg = lang.fail;\n      //     this.$emit(\"crop-upload-fail\", err, field, ki);\n      //   }\n      // });\n      // uploadInstance.start();\n    },\n    closeHandler(e) {\n      if (this.value && (e.key === \"Escape\" || e.keyCode === 27)) {\n        this.off();\n      }\n    },\n  },\n};\n"]},"sourceType":"module","hash":"299ce756acafdca5b2adceb1f07aa0373fd35179"}
