{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/imports/ui/components/BaseEditor/Tinymce/index.vue","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions",["flow",{}],"nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"jsx","jsx","jsx","jsx","jsx"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"sourceFileName":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/imports/ui/components/BaseEditor/Tinymce/index.vue","filename":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/imports/ui/components/BaseEditor/Tinymce/index.vue","passPerPreset":false,"envName":"development","cwd":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui","root":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.7.6","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":{},"_verified":{},"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"TSModuleBlock":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}},{"key":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/node_modules/@vue/babel-preset-jsx/dist/plugin.cjs.js$0","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/node_modules/@vue/babel-preset-jsx/dist/plugin.cjs.js$1","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/node_modules/@vue/babel-preset-jsx/dist/plugin.cjs.js$2","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/node_modules/@vue/babel-preset-jsx/dist/plugin.cjs.js$3","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"babel-plugin-transform-vue-jsx","visitor":{"_exploded":{},"_verified":{},"JSXElement":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/imports/ui/components/BaseEditor/Tinymce/index.vue","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/imports/ui/components/BaseEditor/Tinymce/index.vue"}},"code":"var plugins;\nmodule.link(\"./plugins\", {\n  \"default\": function (v) {\n    plugins = v;\n  }\n}, 0);\nvar toolbar;\nmodule.link(\"./toolbar\", {\n  \"default\": function (v) {\n    toolbar = v;\n  }\n}, 1);\nvar load;\nmodule.link(\"./dynamicLoadScript\", {\n  \"default\": function (v) {\n    load = v;\n  }\n}, 2);\n// why use this cdn, detail see https://github.com/PanJiaChen/tinymce-all-in-one\nvar tinymceCDN = \"https://cdn.jsdelivr.net/npm/tinymce-all-in-one@4.9.3/tinymce.min.js\"; // import { service } from './service'\n\nmodule.exportDefault({\n  name: \"Tinymce\",\n  // components: { editorImage },\n  props: {\n    id: {\n      type: String,\n      \"default\": function () {\n        return \"vue-tinymce-\" + +new Date() + ((Math.random() * 1000).toFixed(0) + \"\");\n      }\n    },\n    value: {\n      type: String,\n      \"default\": \"\"\n    },\n    toolbar: {\n      type: Array,\n      required: false,\n      \"default\": function () {\n        return [];\n      }\n    },\n    menubar: {\n      type: String,\n      \"default\": \"file edit insert view format table\"\n    },\n    height: {\n      type: [Number, String],\n      required: false,\n      \"default\": 360\n    },\n    width: {\n      type: [Number, String],\n      required: false,\n      \"default\": \"auto\"\n    }\n  },\n  data: function () {\n    return {\n      hasChange: false,\n      hasInit: false,\n      tinymceId: this.id,\n      fullscreen: false,\n      languageTypeList: {\n        en: \"en\",\n        zh: \"zh_CN\",\n        es: \"es_MX\",\n        ja: \"ja\"\n      }\n    };\n  },\n  computed: {\n    containerWidth: function () {\n      var width = this.width;\n\n      if (/^[\\d]+(\\.[\\d]+)?$/.test(width)) {\n        // matches `100`, `'100'`\n        return width + \"px\";\n      }\n\n      return width;\n    }\n  },\n  watch: {\n    value: function (val) {\n      var _this2 = this;\n\n      if (!this.hasChange && this.hasInit) {\n        this.$nextTick(function () {\n          return window.tinymce.get(_this2.tinymceId).setContent(val || \"\");\n        });\n      }\n    }\n  },\n  mounted: function () {\n    this.init();\n  },\n  activated: function () {\n    if (window.tinymce) {\n      this.initTinymce();\n    }\n  },\n  deactivated: function () {\n    this.destroyTinymce();\n  },\n  destroyed: function () {\n    this.destroyTinymce();\n  },\n  methods: {\n    init: function () {\n      var _this3 = this;\n\n      // dynamic load tinymce from cdn\n      load(tinymceCDN, function (err) {\n        if (err) {\n          _this3.$message.error(err.message);\n\n          return;\n        }\n\n        _this3.initTinymce();\n      });\n    },\n    urlToBase64: function (url) {\n      return new Promise(function (resolve, reject) {\n        var image = new Image();\n\n        image.onload = function () {\n          var canvas = document.createElement(\"canvas\");\n          canvas.width = this.naturalWidth;\n          canvas.height = this.naturalHeight; // 将图片插入画布并开始绘制\n\n          canvas.getContext(\"2d\").drawImage(image, 0, 0); // result\n\n          var result = canvas.toDataURL(\"image/png\");\n          resolve(result);\n        }; // CORS 策略，会存在跨域问题https://stackoverflow.com/questions/20424279/canvas-todataurl-securityerror\n\n\n        image.setAttribute(\"crossOrigin\", \"Anonymous\");\n        image.src = url; // 图片加载失败的错误处理\n\n        image.onerror = function () {\n          reject(new Error(\"转换失败\"));\n        };\n      });\n    },\n    initTinymce: function () {\n      var _this4 = this;\n\n      var _this = this;\n\n      window.tinymce.init({\n        selector: \"#\" + this.tinymceId,\n        language: this.languageTypeList[\"zh\"],\n        height: this.height,\n        body_class: \"panel-body \",\n        object_resizing: false,\n        toolbar: this.toolbar.length > 0 ? this.toolbar : toolbar,\n        menubar: this.menubar,\n        plugins: plugins,\n        end_container_on_empty_block: true,\n        powerpaste_word_import: \"clean\",\n        paste_data_images: true,\n        images_file_types: \"jpeg,jpg,png,gif,bmp,webp\",\n        code_dialog_height: 450,\n        code_dialog_width: 1000,\n        advlist_bullet_styles: \"square\",\n        advlist_number_styles: \"default\",\n        imagetools_cors_hosts: [\"www.tinymce.com\", \"codepen.io\"],\n        default_link_target: \"_blank\",\n        link_title: false,\n        save: true,\n        images_upload_url: \"/demo/upimg.php\",\n        images_upload_base_path: \"/demo\",\n        images_upload_handler: function (blobInfo, success, failure, progress) {\n          console.log(\"123\");\n\n          _this.urlToBase64(window.URL.createObjectURL(blobInfo.blob())).then(function (res) {// service\n            //   .updatefile({\n            //     file: res.split(',')[1]\n            //   })\n            //   .then((res) => {\n            //     success(res.data.url)\n            //   })\n            //   .catch(() => {\n            //     failure('文件上传失败，请重新上传，或者联系程序员')\n            //   })\n          }); // service\n          //   .updatefile({\n          //     file: window.URL.createObjectURL(blobInfo.blob())\n          //   })\n          //   .then((res) => {\n          //     success(res.data.url)\n          //   })\n          //   .catch(() => {\n          //     failure('文件上传失败，请重新上传，或者联系程序员')\n          //   })\n          // progress(0)\n          // window.tinymce.get(_this.tinymceId).insertContent(`<img class=\"wscnph\" src=\"${blobInfo.blobUri()}\" >`)\n          // progress(100)\n          // success(blobInfo.blobUri())\n          // const token = _this.$store.getters.token\n          // getToken(token)\n          //   .then((response) => {\n          //     const url = response.data.qiniu_url\n          //     const formData = new FormData()\n          //     formData.append('token', response.data.qiniu_token)\n          //     formData.append('key', response.data.qiniu_key)\n          //     formData.append('file', blobInfo.blob(), url)\n          //     upload(formData).then(() => {\n          //       success(url)\n          //       progress(100)\n          //     })\n          //   })\n          //   .catch((err) => {\n          //     failure('出现未知问题，刷新页面，或者联系程序员')\n          //     console.log(err)\n          //   })\n\n        },\n        nonbreaking_force_tab: true,\n        // inserting nonbreaking space &nbsp; need Nonbreaking Space Plugin\n        init_instance_callback: function (editor) {\n          if (_this.value) {\n            editor.setContent(_this.value);\n          }\n\n          _this.hasInit = true;\n          editor.on(\"NodeChange Change KeyUp SetContent\", function () {\n            _this4.hasChange = true;\n\n            _this4.$emit(\"input\", editor.getContent());\n          });\n        },\n        setup: function (editor) {\n          editor.on(\"FullscreenStateChanged\", function (e) {\n            _this.fullscreen = e.state;\n          }); // console.log('零零零零', _this)\n        },\n        convert_urls: true\n      });\n    },\n    destroyTinymce: function () {\n      var _window$tinymce;\n\n      var tinymce = (_window$tinymce = window.tinymce) === null || _window$tinymce === void 0 ? void 0 : _window$tinymce.get(this.tinymceId);\n\n      if (this.fullscreen) {\n        tinymce.execCommand(\"mceFullScreen\");\n      }\n\n      if (tinymce) {\n        tinymce.destroy();\n      }\n    },\n    setContent: function (value) {\n      window.tinymce.get(this.tinymceId).setContent(value);\n    },\n    getContent: function () {\n      window.tinymce.get(this.tinymceId).getContent();\n    },\n    imageSuccessCBK: function (arr) {\n      var _this5 = this;\n\n      arr.forEach(function (v) {\n        return window.tinymce.get(_this5.tinymceId).insertContent(\"<img class=\\\"wscnph\\\" src=\\\"\" + v.url + \"\\\" >\");\n      });\n    }\n  }\n});","map":{"version":3,"sources":["/Users/lourd/Desktop/bpmn/meteor-vue-element-ui/imports/ui/components/BaseEditor/Tinymce/index.vue"],"names":["plugins","module","link","v","toolbar","load","tinymceCDN","exportDefault","name","props","id","type","String","Date","Math","random","toFixed","value","Array","required","menubar","height","Number","width","data","hasChange","hasInit","tinymceId","fullscreen","languageTypeList","en","zh","es","ja","computed","containerWidth","test","watch","val","$nextTick","window","tinymce","get","setContent","mounted","init","activated","initTinymce","deactivated","destroyTinymce","destroyed","methods","err","$message","error","message","urlToBase64","url","Promise","resolve","reject","image","Image","onload","canvas","document","createElement","naturalWidth","naturalHeight","getContext","drawImage","result","toDataURL","setAttribute","src","onerror","Error","_this","selector","language","body_class","object_resizing","length","end_container_on_empty_block","powerpaste_word_import","paste_data_images","images_file_types","code_dialog_height","code_dialog_width","advlist_bullet_styles","advlist_number_styles","imagetools_cors_hosts","default_link_target","link_title","save","images_upload_url","images_upload_base_path","images_upload_handler","blobInfo","success","failure","progress","console","log","URL","createObjectURL","blob","then","res","nonbreaking_force_tab","init_instance_callback","editor","on","$emit","getContent","setup","e","state","convert_urls","execCommand","destroy","imageSuccessCBK","arr","forEach","insertContent"],"mappings":"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","sourcesContent":["\n/**\n * docs:\n * https://panjiachen.github.io/vue-element-admin-site/feature/component/rich-editor.html#tinymce\n */\n// import editorImage from './components/EditorImage'\nimport plugins from \"./plugins\";\nimport toolbar from \"./toolbar\";\nimport load from \"./dynamicLoadScript\";\n\n// why use this cdn, detail see https://github.com/PanJiaChen/tinymce-all-in-one\nconst tinymceCDN =\n  \"https://cdn.jsdelivr.net/npm/tinymce-all-in-one@4.9.3/tinymce.min.js\";\n// import { service } from './service'\nexport default {\n  name: \"Tinymce\",\n  // components: { editorImage },\n  props: {\n    id: {\n      type: String,\n      default: function () {\n        return (\n          \"vue-tinymce-\" +\n          +new Date() +\n          ((Math.random() * 1000).toFixed(0) + \"\")\n        );\n      },\n    },\n    value: {\n      type: String,\n      default: \"\",\n    },\n    toolbar: {\n      type: Array,\n      required: false,\n      default() {\n        return [];\n      },\n    },\n    menubar: {\n      type: String,\n      default: \"file edit insert view format table\",\n    },\n    height: {\n      type: [Number, String],\n      required: false,\n      default: 360,\n    },\n    width: {\n      type: [Number, String],\n      required: false,\n      default: \"auto\",\n    },\n  },\n  data() {\n    return {\n      hasChange: false,\n      hasInit: false,\n      tinymceId: this.id,\n      fullscreen: false,\n      languageTypeList: {\n        en: \"en\",\n        zh: \"zh_CN\",\n        es: \"es_MX\",\n        ja: \"ja\",\n      },\n    };\n  },\n  computed: {\n    containerWidth() {\n      const width = this.width;\n      if (/^[\\d]+(\\.[\\d]+)?$/.test(width)) {\n        // matches `100`, `'100'`\n        return `${width}px`;\n      }\n      return width;\n    },\n  },\n  watch: {\n    value(val) {\n      if (!this.hasChange && this.hasInit) {\n        this.$nextTick(() =>\n          window.tinymce.get(this.tinymceId).setContent(val || \"\")\n        );\n      }\n    },\n  },\n  mounted() {\n    this.init();\n  },\n  activated() {\n    if (window.tinymce) {\n      this.initTinymce();\n    }\n  },\n  deactivated() {\n    this.destroyTinymce();\n  },\n  destroyed() {\n    this.destroyTinymce();\n  },\n  methods: {\n    init() {\n      // dynamic load tinymce from cdn\n      load(tinymceCDN, (err) => {\n        if (err) {\n          this.$message.error(err.message);\n          return;\n        }\n        this.initTinymce();\n      });\n    },\n    urlToBase64(url) {\n      return new Promise((resolve, reject) => {\n        const image = new Image();\n        image.onload = function () {\n          const canvas = document.createElement(\"canvas\");\n          canvas.width = this.naturalWidth;\n          canvas.height = this.naturalHeight;\n          // 将图片插入画布并开始绘制\n          canvas.getContext(\"2d\").drawImage(image, 0, 0);\n          // result\n          const result = canvas.toDataURL(\"image/png\");\n          resolve(result);\n        };\n        // CORS 策略，会存在跨域问题https://stackoverflow.com/questions/20424279/canvas-todataurl-securityerror\n        image.setAttribute(\"crossOrigin\", \"Anonymous\");\n        image.src = url;\n        // 图片加载失败的错误处理\n        image.onerror = () => {\n          reject(new Error(\"转换失败\"));\n        };\n      });\n    },\n    initTinymce() {\n      const _this = this;\n      window.tinymce.init({\n        selector: `#${this.tinymceId}`,\n        language: this.languageTypeList[\"zh\"],\n        height: this.height,\n        body_class: \"panel-body \",\n        object_resizing: false,\n        toolbar: this.toolbar.length > 0 ? this.toolbar : toolbar,\n        menubar: this.menubar,\n        plugins: plugins,\n        end_container_on_empty_block: true,\n        powerpaste_word_import: \"clean\",\n        paste_data_images: true,\n        images_file_types: \"jpeg,jpg,png,gif,bmp,webp\",\n        code_dialog_height: 450,\n        code_dialog_width: 1000,\n        advlist_bullet_styles: \"square\",\n        advlist_number_styles: \"default\",\n        imagetools_cors_hosts: [\"www.tinymce.com\", \"codepen.io\"],\n        default_link_target: \"_blank\",\n        link_title: false,\n        save: true,\n        images_upload_url: \"/demo/upimg.php\",\n        images_upload_base_path: \"/demo\",\n        images_upload_handler(blobInfo, success, failure, progress) {\n          console.log(\"123\");\n          _this\n            .urlToBase64(window.URL.createObjectURL(blobInfo.blob()))\n            .then((res) => {\n              // service\n              //   .updatefile({\n              //     file: res.split(',')[1]\n              //   })\n              //   .then((res) => {\n              //     success(res.data.url)\n              //   })\n              //   .catch(() => {\n              //     failure('文件上传失败，请重新上传，或者联系程序员')\n              //   })\n            });\n          // service\n          //   .updatefile({\n          //     file: window.URL.createObjectURL(blobInfo.blob())\n          //   })\n          //   .then((res) => {\n          //     success(res.data.url)\n          //   })\n          //   .catch(() => {\n          //     failure('文件上传失败，请重新上传，或者联系程序员')\n          //   })\n          // progress(0)\n          // window.tinymce.get(_this.tinymceId).insertContent(`<img class=\"wscnph\" src=\"${blobInfo.blobUri()}\" >`)\n          // progress(100)\n          // success(blobInfo.blobUri())\n          // const token = _this.$store.getters.token\n          // getToken(token)\n          //   .then((response) => {\n          //     const url = response.data.qiniu_url\n          //     const formData = new FormData()\n          //     formData.append('token', response.data.qiniu_token)\n          //     formData.append('key', response.data.qiniu_key)\n          //     formData.append('file', blobInfo.blob(), url)\n          //     upload(formData).then(() => {\n          //       success(url)\n          //       progress(100)\n          //     })\n          //   })\n          //   .catch((err) => {\n          //     failure('出现未知问题，刷新页面，或者联系程序员')\n          //     console.log(err)\n          //   })\n        },\n        nonbreaking_force_tab: true, // inserting nonbreaking space &nbsp; need Nonbreaking Space Plugin\n        init_instance_callback: (editor) => {\n          if (_this.value) {\n            editor.setContent(_this.value);\n          }\n          _this.hasInit = true;\n          editor.on(\"NodeChange Change KeyUp SetContent\", () => {\n            this.hasChange = true;\n            this.$emit(\"input\", editor.getContent());\n          });\n        },\n        setup(editor) {\n          editor.on(\"FullscreenStateChanged\", (e) => {\n            _this.fullscreen = e.state;\n          });\n          // console.log('零零零零', _this)\n        },\n        convert_urls: true,\n      });\n    },\n    destroyTinymce() {\n      const tinymce = window.tinymce?.get(this.tinymceId);\n      if (this.fullscreen) {\n        tinymce.execCommand(\"mceFullScreen\");\n      }\n\n      if (tinymce) {\n        tinymce.destroy();\n      }\n    },\n    setContent(value) {\n      window.tinymce.get(this.tinymceId).setContent(value);\n    },\n    getContent() {\n      window.tinymce.get(this.tinymceId).getContent();\n    },\n    imageSuccessCBK(arr) {\n      arr.forEach((v) =>\n        window.tinymce\n          .get(this.tinymceId)\n          .insertContent(`<img class=\"wscnph\" src=\"${v.url}\" >`)\n      );\n    },\n  },\n};\n"]},"sourceType":"module","hash":"cb6da9ad2f56e344fd81bc40fa84f8d9e0cf971b"}
